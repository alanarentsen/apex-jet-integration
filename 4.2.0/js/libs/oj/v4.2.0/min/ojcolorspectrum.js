/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojcolor","ojs/ojslider","jqueryui-amd/widgets/draggable","ojs/ojtouchproxy","ojs/ojeditablevalue"],function(a,g){(function(){function c(a){var c;c=a.kG();var e=a.bG(),f=a.ZF();c/=255;var e=e/255,f=f/255,g=Math.max(c,e,f),k=Math.min(c,e,f),l,m=(g+k)/2;if(g==k)l=k=0;else{var n=g-k,k=.5<m?n/(2-g-k):n/(g+k);switch(g){case c:l=(e-f)/n+(e<f?6:0);break;case e:l=(f-c)/n+2;break;case f:l=(c-e)/n+4}l/=6}c=[l,k,m];c[0]*=360;c[1]*=100;c[2]*=100;c.push(a.YF());
return c}a.ib("oj.ojColorSpectrum",g.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{labelledBy:null,value:null,rawValue:null},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var c=a.subId;a=this._super(a);if(!a)switch(c){case "oj-spectrum":a=this.ao[0];break;case "oj-spectrum-thumb":a=this.Ye[0];break;case "oj-hue-slider-bar":a=this.Vm.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-hue-slider-bar-value":a=this.Vm.ojSlider("getNodeBySubId",
{subId:"oj-slider-bar-value"});break;case "oj-hue-slider-thumb":a=this.Vm.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"});break;case "oj-opacity-slider-bar":a=this.Um.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-opacity-slider-bar-value":a=this.Um.ojSlider("getNodeBySubId",{subId:"oj-slider-bar-value"});break;case "oj-opacity-slider-thumb":a=this.Um.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"})}return a},getSubIdByNode:function(a){if(!a)return null;var c=g(a),
e=null,f;c.hasClass("oj-colorspectrum-spectrum")?e="oj-spectrum":c.hasClass("oj-colorspectrum-thumb")?e="oj-spectrum-thumb":(f=c.closest(".oj-slider"),f=f.hasClass("oj-slider-vertical")?"hue":"opacity",c.hasClass("oj-slider-bar")?e="oj-"+f+"-slider-bar":c.hasClass("oj-slider-bar-value")?e="oj-"+f+"-slider-bar-value":c.hasClass("oj-slider-thumb")&&(e="oj-"+f+"-slider-thumb"));return null!=e?{subId:e}:this._super(a)},_destroy:function(){this.Fh&&(this.RJa(),this.TLa(),this.fXa(),this.Fh.removeClass("oj-colorspectrum"),
this.Yz());this._super()},rc:function(){this._super();this.JSa()},Pf:function(){var b;this._super();this.hk(null,this.options.labelledBy,this.Ye);this.$()||(b=this.wz());b?(b=b.attr("id"))?this.Ye.attr("aria-labelledby",b):a.D.warn("JET Color Spectrum: The label for this component needs an id in order to be accessible"):(b=this.element.attr("aria-label"))&&this.Ye.attr("aria-label",b)},_setOption:function(a,c,e){var f=this.options.labelledBy;switch(a){case "value":this.W7(c);break;case "disabled":this.aM(c,
!0);break;case "labelledBy":this.hk(f,c,this.Ye)}this._super(a,c,e)},kn:function(b,c){if("string"===typeof b)try{b=new a.o(b)}catch(e){a.D("ojColorSpectrum (id\x3d'"+this.element.attr("id")+"'): invalid "+this.qM+" ("+b+"), defaulting to black"),b=a.o.BLACK}var f={};f._context={originalEvent:c,Rc:!0,Sa:!0,readOnly:!0};this.qKa(this.options[this.qM],b)||this.option(this.qM,b,f)},hk:a.ka.hk,qKa:function(a,c){return a.kG()===c.kG()&&a.bG()===c.bG()&&a.ZF()===c.ZF()&&a.YF()===c.YF()},eR:function(b,c){var e=
c instanceof a.o;return b instanceof a.o&&e&&b.isEqual(c)},aM:function(a,c){var e=!c||c&&a!==this.zr;e&&(this.NMa(!a),a?(this.element.addClass("oj-disabled"),this.aqa(!1)):(this.element.removeClass("oj-disabled"),this.aqa(!0)),this.zr=a);return e},W7:function(b){b instanceof a.o&&!this.eR(this.$f,b)&&(this.Nsa(b),this.sta(this.Qr,!0),this.sta(this.Ep,!1),this.a8(this.Qr,this.iF,this.PE,this.Ep,!0))},Gqa:function(b,c){var e,f,h,k,l;if(this.Pta&&("rawValue"==c.option||"value"==c.option)&&void 0!==c.value&&
("value"==c.option&&(this.ypa=!!b.originalEvent),f=g(b.target),e=f.hasClass("oj-colorspectrum-hue"),f=f.hasClass("oj-colorspectrum-alpha"),e||f)){f=this.Qr;h=this.iF;k=this.PE;l=this.Ep;e?(f=c.value,this.oV(f,h,k),this.a8(f,h,k,l,!1)):(l=c.value,this.SL(f,h,k,l));e=new a.o({h:f,s:h,l:k,a:l});if(b.originalEvent||this.ypa)this.ypa=!1,"rawValue"===c.option?this.kn(e,b):"value"===c.option&&this.jc(e,b);this.Nsa(e)}},sta:function(a,c){(c?this.Vm:this.Um).ojSlider("option","value",a)},a8:function(a,c,e,
f,g){this.ao.css("background-color","hsl("+a+", 100%, 50%)");g&&(g=this.xPa(c,e),this.lF(g.x,g.y));this.SL(a,c,e,f)},lZa:function(){var b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)";switch(a.Ja.rl().browser){case a.Ja.Ag.HC:b="moz";break;default:b="webkit";break;case a.Ja.Ag.gz:b="ms"}b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)".replace(/___/g,
b);this.ao.css("backgroundImage",b)},lF:function(a,c){isNaN(a)||(this.Hx=a);isNaN(c)||(this.Ix=c);this.lqa(0,0)},xPa:function(a,c){var e=Math.min(a/100*this.Nu,this.Nu),f=this.bq-Math.min(c/100*this.bq,this.bq);return{x:Math.round(e),y:Math.round(f)}},lqa:function(a,c){var e,f;e=this.Hx+a;f=this.Ix+c;0>e&&(e=0);0>f&&(f=0);e>=this.Nu&&(e=this.Nu-1);f>=this.bq&&(f=this.bq-1);this.Hx=e;this.Ix=f;e=e-this.km+"px";f=f-this.km+"px";this.Ye[0].style.left=e;this.Ye[0].style.top=f},PZa:function(b){if(!this.zr){var c=
this.ao.offset(),e=b.pageX-c.left,c=b.pageY-c.top,f,g,k,e=Math.round(e),c=Math.round(c);f=this.h4(e,c);g=f.aY;k=f.raa;f=this.Qr;this.oV(f,g,k);var l=new a.o({h:f,s:g,l:k,a:this.Ep});this.kn(l,b);this.jc(l,b);this.SL(f,g,k,this.Ep);this.$f=l;this.pta(g,k);this.lF(e,c);this.Ye.focus()}},aUa:function(a){var c,e,f,g=1;this.Opa=(new Date).getTime();0>this.ix&&(this.ix=this.Opa,this.Npa=0);c=this.Opa-this.ix;this.Npa++;if(1400<c||25<this.Npa)g=3;e=f=0;c=a.keyCode;if(40==c)f=g;else if(38==c)f=-g;else if(39==
c)e=g;else if(37==c)e=-g;else if(36==c)this.lF(0,0),this.ix=-1;else if(35==c)this.lF(this.Nu-1,this.bq-1),this.ix=-1;else if(33==c)this.lF(NaN,0),this.ix=-1;else if(34==c)this.lF(NaN,this.bq-1),this.ix=-1;else return;this.lqa(e,f);this.doa(a,this.Hx,this.Ix);a.preventDefault();return!1},cUa:function(a){this.ix=-1;var c=this.h4(this.Hx,this.Ix);this.SL(this.Qr,c.aY,c.raa,this.Ep);this.jc(this.options[this.qM],a)},VSa:function(){this.ao[0].getBoundingClientRect();this.B8||(this.B8=this.g_a.bind(this));
this.Ye.draggable({drag:this.B8,stop:this.B8})},aqa:function(a){this.Ye.draggable(a?"enable":"disable")},g_a:function(a,c){var e,f,g,k;c.position.left<-this.km?(c.position.left=-this.km,e=0):c.position.left+this.km>=this.Nu&&(c.position.left=this.Nu-1-this.km,f=this.Nu-1);c.position.top<-this.km?(c.position.top=-this.km,f=0):c.position.top+this.km>=this.bq&&(c.position.top=this.bq-1-this.km,f=this.bq-1);g=this.Ye.offset();k=this.ao.offset();0!=e&&(e=g.left+this.km-k.left);0!=f&&(f=g.top+this.km-k.top);
if(this.Hx!==e||this.Ix!==f)"drag"===a.type?(this.Hx=e,this.Ix=f):(e=this.Hx,f=this.Ix),this.doa(a,e,f)},doa:function(b,c,e){var f,g,k=!1;f=this.Qr;e=this.h4(c,e);c=e.aY;e=e.raa;this.oV(f,c,e);g=new a.o({h:f,s:c,l:e,a:this.Ep});this.kn(g,b);"dragstop"===b.type&&(this.jc(g,b.originalEvent),k=!0);this.$f=g;this.pta(c,e);k&&this.SL(f,c,e,this.Ep)},h4:function(a,c){return{aY:a/(this.Nu-1)*100,raa:100-c/(this.bq-1)*100}},oV:function(a,c,e){var f="hsla("+a+","+c+"%,"+e+"%, 0)";c="hsla("+a+","+c+"%,"+e+
"%, 1.0)";this.KE&&(a=c,c=f,f=a);this.v2=a="linear-gradient(90deg, "+f+", "+c+"),"+this.Q0;this.UH.css("background",a)},uPa:function(a,c,e,f){var g="number"===typeof f&&1>f;a=Math.round(a);c=Math.round(100*c)/100;e=Math.round(100*e)/100;return a="hsl"+(g?"a(":"(")+(a+", "+c+"%, "+e+"%"+(g?","+f:"")+")")},pta:function(a,c){this.iF=a;this.PE=c},Nsa:function(a){a&&(this.$f=a,a=c(a),this.Qr=a[0],this.iF=a[1],this.PE=a[2],this.Ep=a[3])},SL:function(a,c,e,f){this.Ye.attr("aria-valuetext",this.uPa(a,c,e,
f))},JSa:function(){this.AK();this.qb()},qb:function(){this.Fh.append(this.YK);this.Fh.addClass("oj-colorspectrum");g(".oj-colorspectrum-hue").uniqueId();g(".oj-colorspectrum-alpha").uniqueId();this.Fh.find(".oj-colorspectrum-container");this.Vm=this.Fh.find(".oj-colorspectrum-hue");this.Um=this.Fh.find(".oj-colorspectrum-alpha");this.ao=this.Fh.find(".oj-colorspectrum-spectrum");this.Ye=this.Fh.find(".oj-colorspectrum-thumb");this.km=this.Ye[0].offsetWidth/2;0>=this.km&&(this.km=this.Ye.width()/
2);this.JA=a.Q.qe();this.Nu=this.ao.width();this.bq=this.ao.height();this.Ye.attr("aria-describedby",this.Fh.find(".oj-colorspectrum-thumb-description").uniqueId().attr("id"));this.Q0="url('"+a.ra.Db("common/images/spectrum-opacity-slider-bg.png")+"')";this.Q0=this.Q0.replace("js","css");var b=this.zr?!0:!1,d=c(this.$f);this.Qr=d[0];this.iF=d[1];this.PE=d[2];this.Ep=d[3];this.Pta=!1;this.Vm.ojSlider({max:360,min:0,step:1,value:this.Qr,orientation:"vertical",optionChange:this.Gqa.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal",
"");this.Um.ojSlider({max:1,min:0,step:.01,value:this.Ep,orientation:"horizontal",optionChange:this.Gqa.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal","");this.SSa();this.lZa();this.a8(this.Qr,this.iF,this.PE,this.Ep,!0);this.ao.click(this.PZa.bind(this));this.VSa();this.aM(b);this.Ye.keydown(this.aUa.bind(this));this.Ye.keyup(this.cUa.bind(this));this.ao.focus(this.gVa.bind(this));this._focusable({element:this.Ye,H9a:!0});a.Q.qe()&&this.h8(this.Ye)},gVa:function(){this.Ye.focus();
return!1},SSa:function(){var a={subId:"oj-slider-bar"};this.VH=g(this.Vm.ojSlider("getNodeBySubId",a));this.UH=g(this.Um.ojSlider("getNodeBySubId",a));a.v$a="oj-slider-bar-value";g(this.Vm.ojSlider("getNodeBySubId",a));g(this.Um.ojSlider("getNodeBySubId",a));this.VH.css("background","linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)");this.x2="linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)";
this.oV(this.Qr,this.iF,this.PE);this.Pta=!0},AK:function(){this.Y0();this.Ix=this.Hx=0;var a=this.Gg(this.T("labelHue")),c=this.Gg(this.T("labelOpacity"));this.YK=["\x3cdiv class\x3d'oj-colorspectrum-container'\x3e\x3cdiv class\x3d'oj-colorspectrum-spectrum' tabindex\x3d'-1' style\x3d'position:relative'\x3e\x3cdiv class\x3d'oj-colorspectrum-thumb' role\x3d'slider' aria-describedby\x3d'' style\x3d'position:absolute;top:-9999px;left:-9999px;' tabIndex\x3d'0'\x3e\x3c/div\x3e\x3c/div\x3e","\x3cdiv class\x3d'oj-colorspectrum-thumb-description oj-helper-hidden-accessible'\x3e"+
this.Gg(this.T("labelThumbDesc"))+"\x3c/div\x3e","\x3cinput class\x3d'oj-colorspectrum-hue' aria-label\x3d'"+a+"'\x3e\x3c/input\x3e","\x3cinput class\x3d'oj-colorspectrum-alpha' aria-label\x3d'"+c+"'\x3e\x3c/input\x3e","\x3c/div\x3e"].join("");this.ix=-1;this.KE="rtl"===this.Wc()},Y0:function(){var b=this.options,c;this.Fh=g(this.element);this.zr=!1;this.qM=this.$()?"transientValue":"rawValue";c=b.value;c instanceof a.o||(c=null);this.$f=c?c:a.o.BLACK;b[this.qM]=this.$f;c=b.disabled;this.zr="boolean"===
typeof c?c:!1},NMa:function(a){var c=!a;a?(this.Vm.ojSlider("option","disabled",c),this.Um.ojSlider("option","disabled",c),c={subId:"oj-slider-bar"},this.Vm=this.Fh.find(".oj-colorspectrum-hue"),this.Um=this.Fh.find(".oj-colorspectrum-alpha"),this.VH=g(this.Vm.ojSlider("getNodeBySubId",c)),this.UH=g(this.Um.ojSlider("getNodeBySubId",c)),this.v2&&this.UH.css("background",this.v2),this.x2&&this.VH.css("background",this.x2)):((a=this.VH.css("background"))&&0<a.length&&(this.x2=a),(a=this.UH.css("background"))&&
0<a.length&&(this.v2=a),this.VH.css("background",""),this.UH.css("background",""),this.Vm.ojSlider("option","disabled",c),this.Um.ojSlider("option","disabled",c))},TLa:function(){this.Vm.ojSlider("destroy");this.Um.ojSlider("destroy")},fXa:function(){this.Fh.empty()},RJa:function(){this.ao.off("click");this.Ye.off("mousedown");this.Ye.off("keydown");this.Ye.off("keyup");this.pM&&this.y8(this.Ye)},Yz:function(){this.YK=this.Fh=this.Vm=this.Um=this.ao=this.Ye=null},h8:function(b){this.pM=a.kh.t9(b)},
y8:function(b){a.kh.rba(b)},_GetMessagingLauncherElement:function(){return this.element},xe:function(){return this.Ye},gw:function(){return this.$f},Uk:function(b){this.$f="string"===typeof b?new a.o(b):b},$i:function(){return this.$f.toString()},_GetDefaultStyleClass:function(){return"oj-colorspectrum"},Gg:function(a){return g("\x3cspan\x3e"+a+"\x3c/span\x3e").text()}})})();a.J.Ua("oj-color-spectrum","editableValue",{properties:{labelledBy:{type:"string"},transientValue:{readOnly:!0,writeback:!0},
value:{writeback:!0}},methods:{},extension:{Ya:"ojColorSpectrum"}});a.J.register("oj-color-spectrum",{metadata:a.J.getMetadata("oj-color-spectrum")})});