/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojdnd","ojs/ojlistview"],function(a,g){a.va=function(a){this.ya=a};o_("ListViewDndContext",a.va,a);a.f.ua(a.va,a.f,"oj.ListViewDndContext");a.va.wca=67;a.va.rP=86;a.va.sP=88;a.va.SBa="cut";a.va.OBa="copy";a.va.$Ca="paste";a.va.dP="pasteBefore";a.va.cP="pasteAfter";a.va.prototype.reset=function(){this.W8();this.Pn=this.yN=this.EG=this.Maa=null};a.va.prototype.u3=function(a){var b=this.ya.pc("dnd");return null!=b&&b[a]?b[a].items:null};a.va.prototype.Ow=function(){return this.u3("drag")};
a.va.prototype.eS=function(){return this.u3("drop")};a.va.prototype.mt=function(){return"enabled"==this.u3("reorder")};a.va.prototype.Tv=function(){return"oj-listview-drag-handle"};a.va.prototype.MO=function(){return"oj-listview-drag-image"};a.va.prototype.dZ=function(){return"oj-listview-drag-item"};a.va.prototype.xH=function(){return"oj-listview-cut"};a.va.prototype.JO=function(){return"oj-listview-"};a.va.prototype.mh=function(a){return this.ya.kp(a)};a.va.prototype.GS=function(){var a,b,d,e;a=
[];if(this.ya.bd())for(b=this.ya.pc("selection"),d=0;d<b.length;d++)e=this.ya.od(b[d]),null==e||this.ya.Vi(g(e))||a.push(e);else e=this.h3(),null!=e&&a.push(e);null!=this.Wo&&0<this.Wo.length&&-1==a.indexOf(this.Wo.get(0))&&a.push(this.Wo.get(0));return a};a.va.prototype.h3=function(){return null==this.ya.ba?null:this.ya.ba.elem[0]};a.va.prototype.XB=function(a){var b;g(a).hasClass(this.ya.wf())||(a=a.firstElementChild);a=g(a).find("."+this.Tv());null!=a&&0<a.length&&(b=a.attr("aria-labelledby"),
null==b?a.attr("aria-labelledby",this.ya.Xt("instr")):a.attr("aria-labelledby",b+" "+this.ya.Xt("instr")),this.ya.Ho()&&a.attr("draggable","true"))};a.va.prototype.W8=function(){this.Wya&&g.each(this.Wya,function(a,b){g(b).removeClass("oj-draggable")})};a.va.prototype.R6a=function(){var a=[],b,d,e;this.W8();b=this.ya.pc("selection");for(d=0;d<b.length;d++)e=this.ya.od(b[d]),null==e||this.ya.Vi(g(e))||(a.push(e),g(e).addClass("oj-draggable"));this.Wya=a};a.va.prototype.ata=function(a){var b;b=a.find("."+
this.Tv());if(null!=b&&0<b.length)return!0;a.addClass("oj-draggable");return!1};a.va.prototype.G_a=function(a){a.removeClass("oj-draggable")};a.va.prototype.Usa=function(a){var b,d;if(null!=this.Ow()||this.mt()){b=this.Tv();if(a.hasClass(b))d=g(a);else if(a=this.mh(a),this.iY())d=a;else{if(null!=a&&(b=this.ata(a)))return;b=this.GS();0<b.length&&(null!=a&&-1<b.indexOf(a[0])?d=a:g(b[0]).removeClass("oj-draggable"))}null!=d&&d.attr("draggable",!0)}};a.va.prototype.Kua=function(a){var b;if(null!=this.Ow()||
this.mt())b=this.Tv(),a=a.hasClass(b)?g(a):this.mh(a),null!=a&&a.removeAttr("draggable")};a.va.prototype.Rp=function(c,b,d,e){var f;if(c="drag"===c?this.Ow():this.eS())if((b=c[b])&&"function"==typeof b)try{this.ya.ea.$()?(b(d.originalEvent,e),d.originalEvent.defaultPrevented&&d.preventDefault()):(d.dataTransfer=d.originalEvent.dataTransfer,f=b(d,e))}catch(g){a.D.error("Error: "+g)}else f=-1;else f=-1;return f};a.va.prototype.AYa=function(a,b,d){var e,f=[],g;for(e=0;e<d.length;e++)(g=this.ya.Ila(d[e]))&&
(g.innerHTML&&g.tagName&&"LI"==g.tagName?f.push(g.innerHTML):f.push(g));return 0<f.length?(this.zYa(a.originalEvent,b,f),this.Mda(a.originalEvent,d),{items:f}):null};a.va.prototype.zYa=function(a,b,d){var e;a=a.dataTransfer;d=JSON.stringify(d);if("string"==typeof b)a.setData(b,d);else if(b)for(e=0;e<b.length;e++)a.setData(b[e],d);a.setData(this.eZ(),this.ya.element.get(0).id)};a.va.prototype.Mda=function(a,b){var d,e,f=Number.MAX_VALUE,h,k,l,m=0,n=0;d=a.target;if(1<b.length){d=g(document.createElement("ul"));
d.get(0).className=this.ya.element.get(0).className;d.addClass(this.MO()).css({width:this.ya.element.css("width"),height:this.ya.element.css("height")});for(e=0;e<b.length;e++)f=Math.min(f,b[e].offsetTop);for(e=0;e<b.length;e++)h=b[e].offsetTop-f,k=b[e].offsetWidth,l=g(b[e].cloneNode(!0)),l.removeClass("oj-selected oj-focus oj-hover").css({position:"absolute",top:h,width:k}),d.append(l)}else g(d).hasClass(this.Tv())?(h=0,g.contains(b[0],d.offsetParent)&&(h=d.offsetTop),m=Math.max(0,d.offsetLeft-b[0].offsetLeft)+
d.offsetWidth/2,n=h+d.offsetHeight/2):(m=Math.max(0,a.offsetX),n=Math.max(0,a.offsetY)),l=g(b[0].cloneNode(!0)),l.removeClass("oj-selected oj-focus oj-hover").addClass("oj-drag"),d=g(document.createElement("ul")),d.get(0).className=this.ya.element.get(0).className,d.addClass(this.MO()).css({width:this.NO(b[0]),height:2*b[0].offsetHeight}).append(l);this.ya.Xg()&&d.addClass("oj-listview-card-layout");g("body").append(d);this.EG=d;a.dataTransfer.setDragImage(d.get(0),m,n)};a.va.prototype.NO=function(){return this.ya.element.css("width")};
a.va.prototype.Sca=function(){return"text/ojlistview-items-data"};a.va.prototype.qK=function(a){var b,d;b=this.Ow();if(null!=b||this.mt())if(b=null!=b?b.dataTypes:this.Sca(),g(a.target).hasClass(this.Tv())||this.iY()?(d=[],d.push(this.mh(a.target)[0])):d=this.GS(),0<d.length)if(this.Pn=d,this.yN=g(d[0]),b=this.AYa(a,b,d)){if(a=this.Rp("drag","dragStart",a,b),-1!==a)return a}else return!1};a.va.prototype.FQa=function(a){return this.Rp("drag","drag",a)};a.va.prototype.uR=function(){null!=this.EG&&(this.EG.remove(),
this.EG=null)};a.va.prototype.N4=function(a){var b;if(null!=this.yN&&null!=this.Pn)for(this.yN.find("."+this.Tv()).removeAttr("draggable"),this.yN.removeClass("oj-drag oj-draggable").removeAttr("draggable"),b=0;b<this.Pn.length;b++)g(this.Pn[b]).removeClass(this.dZ()).css("display","");this.iJ();this.uR();this.W8();this.Rp("drag","dragEnd",a);this.Maa=this.Pn;this.Pn=this.yN=this.EG=null};a.va.prototype.m6=function(a){var b,d;if((b=this.eS())&&b.dataTypes)for(b=b.dataTypes,b="string"==typeof b?[b]:
b,a=a.originalEvent.dataTransfer.types,d=0;d<a.length;d++)if(0<=b.indexOf(a[d]))return!0;return!1};a.va.prototype.Eo=function(a,b,d){a=this.Rp("drop",a,b,d);(void 0===a||-1===a)&&this.m6(b)&&b.preventDefault();return a};a.va.prototype.kja=function(a){var b;null==this.zm&&(b=g(a.get(0).cloneNode(!1)),b.addClass("oj-drop").removeClass("oj-drag oj-draggable oj-hover oj-focus oj-selected").css({display:"block",height:a.outerHeight(),width:a.outerWidth()}),this.zm=b);return this.zm};a.va.prototype.Gia=
function(){null!=this.vk&&-1===this.HG&&this.vk.children("."+this.ya.sg()).removeClass("oj-drop")};a.va.prototype.Fia=function(){null!=this.vk&&this.vk.hasClass(this.ya.aG())&&(this.vk.removeClass("oj-drop"),this.vk.get(0).textContent=this.ya.Pla())};a.va.prototype.iJ=function(){null!=this.zm&&(this.zm.css("height","0"),this.zm.remove(),this.zm=null);this.Fia();this.Gia()};a.va.prototype.O4=function(a){var b;b=this.mh(a.target);a=this.Eo("dragEnter",a,{item:b.get(0)});if(-1!=a)return a};a.va.prototype.P7=
function(a){null!=this.vk&&this.vk.removeClass("oj-valid-drop oj-invalid-drop");this.vk=a;this.vk.addClass("oj-valid-drop")};a.va.prototype.Gsa=function(a,b){var d;d=a.attr("aria-label");null==d&&(d=a.text());d=this.ya.ea.T("accessibleReorder"+b.charAt(0).toUpperCase()+b.substr(1)+"Item",{item:d});this.ya.Ei(d)};a.va.prototype.mIa=function(){null==this.sza&&this.ya.Ho()&&(this.ya.element.find("ul."+this.ya.Vg()).each(function(){g(this).attr("oldMaxHeight",g(this).css("maxHeight").toString());g(this).css("maxHeight",
1E4)}),this.sza="adjusted")};a.va.prototype.nsa=function(){this.ya.Ho()&&this.ya.element.find("ul."+this.ya.Vg()).each(function(){g(this).css("maxHeight",parseInt(g(this).attr("oldMaxHeight"),10));g(this).removeAttr("oldMaxHeight")});this.sza=null};a.va.prototype.Q4=function(a){var b,d,e,f;this.mIa();if(null!=this.Pn&&"none"!=g(this.Pn[0]).css("display")){if(b=g(this.Pn[0]),e=this.Eo("dragOver",a,{item:b.get(0)}),-1===e&&this.mt()||!1===e||a.isDefaultPrevented()){d=this.kja(b);for(a=0;a<this.Pn.length;a++)g(this.Pn[a]).addClass(this.dZ()).css("display",
"none");d.insertBefore(b);this.HG=d.index()}}else b=this.mh(a.target),null!=b&&0<b.length?(e=this.Eo("dragOver",a,{item:b.get(0)}),-1===e&&this.mt()||!1===e||a.isDefaultPrevented()?(b.hasClass(this.ya.wf())?(this.Gia(),b.hasClass("oj-drop")||(d=this.kja(b),f=b.index(),null==this.HG||this.HG<f?(d.insertAfter(b),this.FG="after"):(d.insertBefore(b),this.FG="before"),this.Gsa(b,this.FG),this.P7(b),this.HG=d.index())):(this.iJ(),b.children("."+this.ya.sg()).addClass("oj-drop"),this.P7(b),this.HG=-1,this.FG=
"inside",this.Gsa(b,this.FG)),a.preventDefault()):g(a.target).hasClass(this.ya.Vg())||(b.addClass("oj-invalid-drop"),this.iJ())):(b=this.ya.element.children("."+this.ya.aG()),null!=b&&0<b.length&&(b.addClass("oj-drop"),b.get(0).textContent="",this.P7(b),a.preventDefault()));return e};a.va.prototype.vT=function(a,b){var d,e;d=b.getBoundingClientRect();e=a.originalEvent;return e.clientX>=d.left&&e.clientX<d.right&&e.clientY>=d.top&&e.clientY<d.bottom};a.va.prototype.P4=function(a){var b,d;if(null!=
this.vk&&(b=this.mh(a.target),null!=b&&0<b.length?(b.removeClass("oj-valid-drop oj-invalid-drop"),d=this.Eo("dragLeave",a,{item:b.get(0)}),this.vT(a,a.currentTarget)||(this.iJ(),this.nsa())):this.vT(a,a.currentTarget)||this.Fia(),-1!=d))return d};a.va.prototype.R4=function(a){var b,d;if(null!=this.vk&&(b=a.originalEvent.dataTransfer.getData(this.eZ()),d=this.vk.hasClass(this.ya.aG())?{}:{item:this.vk.get(0),position:this.FG},this.mt()&&b===this.ya.element.get(0).id?d.reorder=!0:d.reorder=!1,null!=
this.vk&&this.vk.removeClass("oj-valid-drop"),this.iJ(),this.nsa(),this.uR(),b=this.Eo("drop",a,d),d.reorder&&(d.items=null==this.Pn?this.Maa:this.Pn,this.ya.Yi("reorder",a,this.NY(d.items,d.position,d.item)),a.preventDefault()),this.vk=null,this.HG=-1,this.Maa=this.FG=null,-1!==b))return b};a.va.prototype.NY=function(a,b,d){return{items:a,position:b,reference:d}};a.va.prototype.fAa=function(a){var b=this,d,e;this.mt()&&(d=g(a),this.Caa!=a&&(this.Caa=a,"OJ-MENU"===a.tagName?(a.addEventListener("ojBeforeOpen",
this.PS.bind(this)),a.addEventListener("ojAction",this.Wj.bind(this))):(d.on("ojbeforeopen",this.PS.bind(this)),d.on("ojselect",this.Wj.bind(this)))),this.Qaa=e=this.zla(a,function(a,c){var d=b.Tl(c,a.tagName);"OJ-OPTION"===a.tagName?(a.innerHTML=d.get(0).innerHTML,g(a).attr("data-oj-command",d.attr("data-oj-command"))):(d.get(0).className=g(a).get(0).className,g(a).replaceWith(d))}),0<e.length&&d.data("oj-ojMenu")&&("OJ-MENU"===a.tagName?a.refresh():g(a).ojMenu("refresh")))};a.va.prototype.Mla=function(){var a=
this,b="",d="cut copy paste paste-before paste-after pasteBefore pasteAfter".split(" ");this.Vya||(d.forEach(function(e,f){b+="[data-oj-command\x3d"+a.JO()+e+"],";b+="[data-oj-command\x3d"+e+"]";f<d.length-1&&(b+=",")}),this.Vya=b);return this.Vya};a.va.prototype.zla=function(c,b){var d,e;e=this;d=[];g(c).find(this.Mla()).each(function(){var c;0===g(this).children("a").length?0==g(this).attr("data-oj-command").indexOf(e.JO())&&(c=g(this).attr("data-oj-command").substring(e.JO().length),b&&b(this,
c)):(c=g(this).attr("data-oj-command"),c==a.va.dP?c="paste-before":c==a.va.cP&&(c="paste-after"));c&&d.push(c)});return d};a.va.prototype.Tl=function(c,b){return"paste-before"===c?this.Lh(a.va.dP,b):"paste-after"===c?this.Lh(a.va.cP,b):this.Lh(c,b)};a.va.prototype.Lh=function(a,b){var d=g(document.createElement(b));d.attr("data-oj-command",a);d.append(this.Sz(a));return d};a.va.prototype.Sz=function(a){a="label"+a.charAt(0).toUpperCase()+a.slice(1);return g('\x3ca href\x3d"#"\x3e\x3c/a\x3e').text(this.ya.ea.T(a))};
a.va.prototype.pK=function(a){var b;null!=this.yq&&g(this.yq).removeClass(this.xH());b=this.Rca(a);this.ya.ea.element.focus();g(b).addClass(this.xH());this.yq=b;this.ya.Yi("cut",a,{items:b})};a.va.prototype.Rca=function(){return this.GS()};a.va.prototype.Fna=function(a){var b;null!=this.yq&&g(this.yq).removeClass(this.xH());this.yq=b=this.GS();this.ya.Yi("copy",a,{items:b})};a.va.prototype.sK=function(a,b,d){this.ya.Yi("paste",a,{item:b.get(0)});g(this.yq).removeClass(this.xH());this.ya.Yi("reorder",
a,this.NY(this.yq,d,b.get(0)));this.yq=null};a.va.prototype.Wj=function(c,b){var d;if(null!=this.Wo)switch(d=b?b.item:g(c.target),d.attr("data-oj-command")){case a.va.SBa:this.pK(c);break;case a.va.OBa:this.Fna(c);break;case a.va.$Ca:var e=!0;case a.va.dP:var f=!0;case a.va.cP:d="after",e?d="inside":f&&(d="before"),this.sK(c,this.Wo,d),this.Wo=null}};a.va.prototype.SI=function(c,b){null!=this.Qaa&&("paste-before"==b?b=a.va.dP:"paste-after"==b&&(b=a.va.cP),c.find("[data-oj-command\x3d'"+b+"']").removeClass("oj-disabled"))};
a.va.prototype.PS=function(a,b){var d,e;d=g(a.target);d.find(this.Mla()).addClass("oj-disabled");e=b?b.openOptions.launcher:a.detail.openOptions.launcher;null==e||null==this.Qaa||0==this.Qaa.length?"OJ-MENU"!=d.get(0).tagName&&d.ojMenu("refresh"):(e.children().first().hasClass(this.ya.sg())?null!=this.yq&&this.SI(d,"paste"):(this.SI(d,"cut"),this.SI(d,"copy"),null!=this.yq&&(this.SI(d,"paste-before"),this.SI(d,"paste-after"))),"OJ-MENU"!=d.get(0).tagName&&d.ojMenu("refresh"),this.Wo=e)};a.va.prototype.BH=
function(c){var b,d,e;if(c.ctrlKey||c.metaKey)if(b=c.keyCode,b===a.va.sP||b===a.va.wca||a.va.rP){if(!this.mt())return!1;d=this.ya.ea.co();if(null==d)return!1;d=this.zla(d);if(0==d.length)return!1;if(b===a.va.sP&&-1<d.indexOf("cut"))return this.pK(c),!0;if(b===a.va.wca&&-1<d.indexOf("copy"))return this.Fna(c),!0;if(b===a.va.rP&&null!=this.yq&&(b=g(this.h3()),b.children().first().hasClass(this.ya.sg())?-1<d.indexOf("paste")&&(e="inside"):-1<d.indexOf("paste-before")?e="before":-1<d.indexOf("paste-after")&&
(e="after"),null!=e))return this.sK(c,b,e),!0}return!1};a.va.prototype.iY=function(){return!1};a.va.prototype.eZ=function(){return"text/ojlistview-dragsource-id"}});