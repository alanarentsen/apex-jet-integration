/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","knockout","ojs/ojcomponentcore","ojs/ojcomposite"],function(a,g,c){a.Te.register("oj-file-picker",{view:{inline:"\x3cinput type\x3d'file' style\x3d'display:none'       data-bind\x3d\"attr:{multiple: $props.selectionMode \x3d\x3d 'multiple',                         accept: acceptStr}\"\x3e\x3c/input\x3e\x3cdiv class\x3d'oj-filepicker-clickable'\x3e  \x3coj-bind-slot name\x3d'trigger'\x3e    \x3cdiv tabindex\x3d'0'         class\x3d'oj-filepicker-dropzone'\x3e      \x3cp class\x3d'oj-filepicker-text' data-bind\x3d'text: defDropzoneText'\x3e\x3c/p\x3e    \x3c/div\x3e  \x3c/oj-bind-slot\x3e\x3c/div\x3e"},
viewModel:{inline:function(b){function d(a){var b=w[0],c=g(r).find(".oj-filepicker-clickable")[0];b&&(b.removeEventListener("dragenter",n,!1),b.removeEventListener("dragover",t,!1),b.removeEventListener("dragleave",s,!1),b.removeEventListener("dragend",s,!1),b.removeEventListener("drop",p,!1));c&&(c.removeEventListener("click",e,!1),c.removeEventListener("keypress",e,!1));switch(a){case "click":k(c);break;case "drop":l(b);c&&c.addEventListener("keypress",e,!1);break;default:k(c),l(b)}}function e(a){x=
!0;a.preventDefault();v.click();return!0}function f(a){a.preventDefault();a.stopPropagation();var b=a.target.files;0<b.length&&q(b,a);x=!1}function h(b){var c=u.accept;if(!c||0==c.length||!b)return!0;for(var d,e=0;e<c.length;e++){d=a.ab.trim(c[e]);if(!d)return!0;if(d.Tn(".",0)){if(!b.name||b.name&&b.name.iwa(d))return!0}else if(!b.type)break;else if("image/*"==d){if(b.type.Tn("image/",0))return!0}else if("video/*"==d){if(b.type.Tn("video/",0))return!0}else if("audio/*"==d){if(b.type.Tn("audio/",0))return!0}else if(b.type==
d)return!0}return!1}function k(a){a&&(a.addEventListener("click",e,!1),a.addEventListener("keypress",e,!1))}function l(a){a&&(a.addEventListener("dragenter",n,!1),a.addEventListener("dragover",t,!1),a.addEventListener("dragleave",s,!1),a.addEventListener("dragend",s,!1),a.addEventListener("drop",p,!1))}function m(a){var b="single"!=r.selectionMode||1==a.length;if(b)a:{if(a)for(b=0;b<a.length;b++)if(!h(a[b])){a=!1;break a}a=!0}else a=b;return a}function n(a){a.preventDefault();a.stopPropagation()}
function t(a){a.preventDefault();a.stopPropagation();a=a.dataTransfer;var b=!a.items||m(a.items);b?(a.dropEffect="copy",w.addClass("oj-valid-drop")):a.dropEffect="none";return b}function s(a){a.preventDefault();a.stopPropagation();w.removeClass("oj-valid-drop")}function p(b){var c=b.dataTransfer.files;if(m(c))q(c,b);else{var d="";if(c)for(var e=0;e<c.length;e++)d+=c[e].name+" ";a.D.warn("oj-file-picker: Files "+d+" are not acceptable.")}s(b)}function q(a,b){var c=new CustomEvent("ojSelect",{detail:{files:a,
originalEvent:b}});r.dispatchEvent(c)}var r=b.element,u,w,v,x=!1;b.props.then(function(a){u=a});this.acceptStr=c.pureComputed(function(){var a=u.accept;return a&&a.length?a.join(","):null},this);r.addEventListener("selectOnChanged",function(a){d(a.detail.value)});this.defDropzoneText=a.Aa.T("oj-ojFilePicker.dropzoneText");this.bindingsApplied=function(){var b=g(r);b.addClass("oj-filepicker");w=b.find(".oj-filepicker-dropzone");d(u.selectOn);b=b.find("input");b.length&&(v=b[0],v.addEventListener("change",
f,!1));w.length&&(w[0].addEventListener("focus",function(){x||(a.Q.qAa()?w.removeClass("oj-focus-highlight"):w.addClass("oj-focus-highlight"))}),w[0].addEventListener("focusout",function(){x||w.removeClass("oj-focus-highlight")}))}}},metadata:{inline:{properties:{accept:{type:"Array"},selectOn:{type:"string",enumValues:["auto","click","drop","clickAndDrop"],value:"auto"},selectionMode:{type:"string",enumValues:["multiple","single"],value:"multiple"}},events:{select:{}}}}})});