/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojanimation","ojs/ojkeyset","ojdnd"],function(a,g){(function(){a.ib("oj.ojTreeView",g.oj.baseComponent,{version:"1.0.0",defaultElement:"\x3cdiv\x3e",widgetEventPrefix:"oj",options:{currentItem:null,data:null,dnd:{drag:null,drop:null},expanded:new a.VY,item:{focusable:null,renderer:null,selectable:null},selection:[],selectionMode:"none",animateEnd:null,animateStart:null,beforeCollapse:null,beforeCurrentItem:null,beforeExpand:null,collapse:null,
expand:null},rc:function(){this._super()},Pf:function(){this._super();this.RSa();this.Ura()},RSa:function(){var a=this;this._on(this.element,{click:function(b){a.J4(b)},mouseover:function(b){a.Y4(b)},mouseout:function(b){a.VS(b)},mousedown:function(b){a.W4(b)},mouseup:function(b){a.Z4(b)},keydown:function(b){a.Or(b)},dragstart:function(b){a.qK(b)},drag:function(b){a.Nna(b,"drag")},dragend:function(b){a.Nna(b,"dragEnd")},dragenter:function(b){a.RS(b,"dragEnter")},dragover:function(b){a.RS(b,"dragOver")},
dragleave:function(b){a.RS(b,"dragLeave")},drop:function(b){a.RS(b,"drop")}});var b=g(document.createElement("span")).addClass("oj-treeview-drop-marker-icon oj-component-icon");this.GR=g(document.createElement("div")).addClass("oj-treeview-drop-marker").append(b).appendTo(this.element);this.vka=this.GR[0].getBoundingClientRect();this.GR.hide();this.DJ=g(document.createElement("div")).addClass("oj-treeview-drop-line").appendTo(this.element);this.JMa=this.DJ[0].getBoundingClientRect();this.DJ.hide()},
Ura:function(){var a=this;this.element.removeClass("oj-complete");this.options.data?(this.element.find("ul").remove(),this.Jka(null,function(b){a.Wra(b,a.element);a.t7();a.element.addClass("oj-complete")})):(this.element.find("ul").addClass("oj-treeview-list").attr("role","group"),this.element.find("li").each(function(){var b=g(this);a.Jja(b)}),this.t7(),this.element.addClass("oj-complete"));this.KLa();this.UK=null},Jka:function(c,b){var d=this.options.data,e={start:0,count:d.getChildCount(c)},f=
this.Hg("fetching data");d.fetchChildren(c,e,{success:function(a){b(a);f()},error:function(b){a.D.error(b);f()}})},Wra:function(a,b){for(var d=g(document.createElement("ul")).addClass("oj-treeview-list").attr("role","group").appendTo(b),e=0;e<a.getCount();e++)this.AXa(d,a,e)},AXa:function(c,b,d){d+=b.getStart();var e=b.getData(d);b=b.getMetadata(d);var f=b.key,h=this.options.item.renderer,h=this.Rl(h),k=g(document.createElement("li")).attr("id",f).appendTo(c);if(h){var l={};l.parentElement=k;l.index=
d;l.data=e;l.datasource=this.options.data;l.parentKey=this.nb(this.xS(k));l.component=a.Components.qd(this.element);this.Sk&&(l=this.Sk(l));for(var m in b)b.hasOwnProperty(m)&&(l[m]=b[m]);m=h.call(this,l);null!=m&&(null===m.parentNode||m.parentNode instanceof DocumentFragment?k.append(m):null==m.parentNode&&m.toString&&(h=document.createElement("span"),h.appendChild(document.createTextNode(m.toString())),k.append(h)));k=c.children().eq(d);l.parentElement=k;null==k.attr("id")&&k.attr("id",f)}k.data("data",
e).data("metadata",b);this.Jja(k)},KLa:function(){var a=this,b=this.Xma();this._focusable({element:b,applyHighlight:!0,setupHandlers:function(b,d){a.Uj=b;a.fj=d}});b.attr("tabIndex",0).on("focus",function(){a.Uj(a.ku(a.xr))}).on("blur",function(){a.fj(a.ku(a.xr))}).attr("role","tree").attr("aria-labelledby",this.element.attr("id"));var d=this.options.selectionMode;"none"!=d?b.attr("aria-multiselectable","multiple"==d?"true":"false"):b.removeAttr("aria-multiselectable")},Jja:function(a){a.addClass("oj-treeview-item").attr("role",
"treeitem");var b=this.ku(a);0==b.length&&(b=g(document.createElement("div")).addClass("oj-treeview-item-content").append(a.children(":not(ul)")).prependTo(a),b.find(".oj-treeview-item-icon").addClass("oj-treeview-icon"));this.Di(a);var d=this.Ow();b.attr("draggable",0<Object.keys(d).length?"true":"false");b=a.children(".oj-treeview-spacer");0==b.length&&(b=g(document.createElement("ins")).addClass("oj-treeview-icon oj-treeview-spacer").prependTo(a));this.Go(a)?a.addClass("oj-treeview-leaf"):(this.spa(a)?
this.ze(a,!1):this.qi(a,!1),b.addClass("oj-treeview-disclosure-icon oj-component-icon oj-clickable-icon-nocontext oj-default"))},$l:function(){return this.element.find(".oj-treeview-item")},nb:function(a){var b=a.data("metadata");return b?b.key:a.attr("id")},I3:function(a){return this.element.find("li#"+a)},ku:function(a){return a.children(".oj-treeview-item-content")},tla:function(a){return a.children(".oj-treeview-list").children(".oj-treeview-item")},xS:function(a){return a.parent(".oj-treeview-list").parent(".oj-treeview-item")},
nK:function(a){return a.children(".oj-treeview-list")},Xma:function(){return this.element.children(".oj-treeview-list")},Go:function(a){var b=a.data("metadata");return!(b?!b.leaf:0<this.nK(a).length)},spa:function(a){a=this.nb(a);var b=this.options.expanded;return b&&b.has?b.has(a):!1},hm:function(a){return a.hasClass("oj-expanded")},ze:function(a,b,d,e){var f=this;if(!(this.hm(a)||this.Go(a)||b&&!this._trigger("beforeExpand",d,this.aK(a))&&!1!==e)){if(0==this.nK(a).length)return f.Jka(f.nb(a),function(e){f.Wra(e,
a);f.Bka(a,b,d)});f.Bka(a,b,d);this.UK=null}},Bka:function(a,b,d){var e=this;a.removeClass("oj-collapsed").addClass("oj-expanded").attr("aria-expanded","true");var f=this.nK(a);f.css("max-height","none");if(b){var g=this.Hg("animating expand");a.addClass("oj-treeview-animated");this.sF(f,"expand").then(function(){a.removeClass("oj-treeview-animated");e._trigger("expand",d,e.aK(a));var b=e.options.expanded.add([e.nb(a)]);e.MF("expanded",b,d);g()})}},qi:function(a,b,d,e){var f=this;if(!(a.hasClass("oj-collapsed")||
this.Go(a)||b&&!this._trigger("beforeCollapse",d,this.aK(a))&&!1!==e)){a.removeClass("oj-expanded").addClass("oj-collapsed").attr("aria-expanded","false");var g=this.nK(a);if(b){var k=this.Hg("animating collapse");a.addClass("oj-treeview-animated");this.sF(g,"collapse").then(function(){g.css("max-height",0);a.removeClass("oj-treeview-animated");f._trigger("collapse",d,f.aK(a));var b=f.options.expanded["delete"]([f.nb(a)]);f.MF("expanded",b,d);k()})}else g.css("max-height",0);this.UK=null}},sF:function(c,
b){this.kq||(this.kq=a.ic.ad("oj-treeview-option-defaults"));return a.ca.Li(c[0],b,(this.kq.animation||{})[b],this)},aK:function(a){return{key:this.nb(a),item:a[0]}},sT:function(a,b){var d=this.options.item[b+"able"];if(!1===d)return!1;if("function"===typeof d){var e=this.getContextByNode(a[0]);return d(e)}return!0},zi:function(a){a=this.nb(a);return-1!=this.options.selection.indexOf(a)},Di:function(c,b){var d=this.options.selectionMode;if("none"!=d&&this.sT(c,"select")){var e=this.zi(c);if(b){var f=
a.Q.qe(),g=a.Q.Ks(b),k="multiple"==d,l=40==b.keyCode||38==b.keyCode,d=this.nb(c),m=[];if(k&&b.shiftKey&&!l){g?m=this.options.selection.slice(0):this.Xk();for(f=(e=this.UK)&&e.offset().top<c.offset().top?this.b4.bind(this):this.g4.bind(this);e&&e[0]!=c[0];)g=this.nb(e),-1==m.indexOf(g)&&(m.push(g),this.SU(e)),e=f(e,"select");e=!0;m.push(d)}else k&&(g||f||l)?(e=!e,m=this.options.selection.slice(0),e?m.push(d):m.splice(m.indexOf(d),1)):(this.Xk(),(f||32==b.keyCode)&&e?(e=!1,m=[]):(e=!0,m=[d]));this.MF("selection",
m,b);this.UK=c}e?this.SU(c):this.vta(c)}},SU:function(a){this.ku(a).addClass("oj-selected");a.attr("aria-selected","true")},vta:function(a){this.ku(a).removeClass("oj-selected");a.attr("aria-selected","false")},Xk:function(){this.vta(this.$l())},nh:function(a,b){if(this.sT(a,"focus")){if(b){var d=this.aK(a);this.xr&&(d.previousKey=this.nb(this.xr),d.previousItem=this.xr[0]);if(!this._trigger("beforeCurrentItem",b,d))return;this.MF("currentItem",this.nb(a),b)}this.fj(this.ku(this.xr));this.Uj(this.ku(a));
this.Q7(a)}},t7:function(){if(this.options.currentItem){var a=this.I3(this.options.currentItem);if(0<a.length){this.Q7(a);return}}a=this.$l().first();this.Q7(a);this.MF("currentItem",this.nb(this.xr),null)},Q7:function(a){this.xr=a;this.Xma().attr("aria-activedescendant",this.nb(a))},Hg:function(c){var b=a.Context.getContext(this.element[0]).Dc(),d=this.element.attr("id");return b.Xc({description:"The component identified by '"+d+"', "+c})},MF:function(a,b,d){this.option(a,b,{_context:{originalEvent:d,
Rc:!0,Sa:!0}})},Ow:function(){return((this.options.dnd||{}).drag||{}).items||{}},eS:function(){return((this.options.dnd||{}).drop||{}).items||{}},$R:function(a){return g(a.target).closest(".oj-treeview-item-content")},SJ:function(a){return g(a.target).closest(".oj-treeview-disclosure-icon")},J4:function(a){var b=this.SJ(a);0<b.length?(b=b.closest(".oj-treeview-item"),this.hm(b)?this.qi(b,!0,a):this.ze(b,!0,a)):(b=this.$R(a),0<b.length?(b=b.parent(),this.Di(b,a),this.nh(b,a)):(this.Xk(),this.UK=null,
this.MF("selection",[],a)))},Y4:function(c){if(!a.Q.qe()){var b=this.SJ(c);0==b.length&&(b=this.$R(c));b.removeClass("oj-default");b.addClass("oj-hover")}},VS:function(c){if(!a.Q.qe()){var b=this.SJ(c);b.removeClass("oj-selected");0==b.length&&(b=this.$R(c));b.addClass("oj-default");b.removeClass("oj-hover")}},W4:function(a){this.SJ(a).addClass("oj-selected")},Z4:function(a){this.SJ(a).removeClass("oj-selected")},Or:function(a){var b=a.keyCode,d=this.xr;if(38==b||40==b){if(b=40==b?this.b4(d,"focus"):
this.g4(d,"focus"))a.preventDefault(),this.zi(d)&&a.shiftKey&&this.Di(this.zi(b)?d:b,a),this.nh(b,a)}else if(37==b||39==b){var e="rtl"==this.Wc(),b=!e&&39==b||e&&37==b;if(!b||this.Go(d)||this.hm(d))if(b||this.Go(d)||!this.hm(d)){if(b=b?this.b4(d,"focus"):this.g4(d,"focus"))a.preventDefault(),this.nh(b,a)}else a.preventDefault(),this.qi(d,!0,a);else a.preventDefault(),this.ze(d,!0,a)}else if(13==b||32==b)a.preventDefault(),this.Di(d,a)},YOa:function(a){if(!this.Go(a)&&this.hm(a)){var b=this.tla(a).first();
if(0<b.length)return b}for(;0<a.length;){b=a.next(".oj-treeview-item");if(0<b.length)return b;a=this.xS(a)}return null},b4:function(a,b){for(;null!=a;)if(a=this.YOa(a),this.sT(a,b))return a;return null},qPa:function(a){for(var b=a.prev(".oj-treeview-item");0<b.length;)if(!this.Go(b)&&this.hm(b)){var d=this.tla(b).last();if(0<d.length)b=d;else return b}else return b;a=this.xS(a);return 0<a.length?a:null},g4:function(a,b){for(;null!=a;)if(a=this.qPa(a),this.sT(a,b))return a;return null},qK:function(a){var b=
this,d="rtl"==this.Wc(),e=this.$R(a).parent();if(0!=e.length){var f=g();if(this.zi(e))for(var h=this.options.selection,e=0;e<h.length;e++)f=f.add(this.I3(h[e]));else this.Di(e,a),f=f.add(e);var h=this.Ow(),k=a.originalEvent.dataTransfer,l=[],m=g(document.createElement("ul")).addClass("oj-treeview-drag-image oj-treeview-list"),n=Infinity,t=Infinity;f.each(function(){var a=g(this);l.push(a.data("data"));var c=a.offset();d&&(c.left=b.ku(a).offset().left);a=a.clone().css({top:c.top,left:c.left});b.nK(a).remove();
c.top<n&&(n=c.top);c.left<t&&(t=c.left);m.append(a)});m.children().each(function(){g(this).css({top:parseFloat(g(this).css("top"))-n,left:parseFloat(g(this).css("left"))-t})});f=h.dataTypes||[];for(e=0;e<f.length;e++)k.setData(f[e],JSON.stringify(l));g("body").append(m);k.setDragImage(m[0],a.pageX-t,a.pageY-n);setTimeout(function(){m.remove()},0);(f=h.dragStart)&&f(a.originalEvent,{items:l})}},Nna:function(a,b){var d=this.Ow()[b];d&&d(a.originalEvent)},RS:function(a,b){var d=this.eS(),e=d.dataTypes||
[],f=d[b],h=g(a.target).closest(".oj-treeview-item"),k=h.children(".oj-treeview-spacer")[0].getBoundingClientRect(),l=(k.top+k.bottom)/2,d="inside",m=a.pageY-k.top;m<.25*k.height?d="before":m>.75*k.height&&(d=this.hm(h)?"first":"after");f&&f(a.originalEvent,{item:h[0],position:d});for(f=0;f<e.length;f++)if((h=a.originalEvent.dataTransfer.types)&&0<=h.indexOf(e[f])){a.preventDefault();break}if("dragEnter"!=b&&"dragOver"!=b||!a.originalEvent.defaultPrevented)this.GR.hide(),this.DJ.hide();else{h="rtl"==
this.Wc();e=l;f=h?k.left-this.JMa.width:k.right;l-=this.vka.height/2;m=k.left+k.width/2-this.vka.width/2;if("before"==d)l-=k.height/2,e-=k.height/2;else if("after"==d||"first"==d)l+=k.height/2,e+=k.height/2,"first"==d&&(k=(h?-1:1)*k.width,m+=k,f+=k);this.GR.css("top",l+"px").css("left",m+"px").show();"inside"!=d?this.DJ.css("top",e+"px").css("left",f+"px").show():this.DJ.hide()}},li:function(a,b,d){if("keyboard"===d){var e=this.xr?this.ku(this.xr):this.element;this.mi(b,d,{launcher:e,initialFocus:"menu",
position:{my:"start top",at:"start bottom",of:e}})}else this._superApply(arguments)},refresh:function(){this._super();this.Ura()},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var b=a.subId;a=this.I3(a.key);var d;"oj-treeview-disclosure"===b?d=a.children(".oj-treeview-disclosure-icon")[0]:"oj-treeview-item"===b&&(d=a[0]);return d||null},getSubIdByNode:function(a){if(!g.contains(this.element[0],a))return null;var b=g(a);if(b.hasClass("oj-treeview-disclosure-icon"))b=
b.parent(),a="oj-treeview-disclosure";else if(b.hasClass("oj-treeview-item"))a="oj-treeview-item";else return null;return{subId:a,key:this.nb(b)}},getContextByNode:function(c){if(!g.contains(this.element[0],c))return null;c=g(c);if(!c.hasClass("oj-treeview-item"))return null;var b={subId:"oj-treeview-item"};b.index=c.parent().children(".oj-treeview-item").index(c);b.parentKey=this.nb(this.xS(c));b.component=a.Components.qd(this.element);this.Sk&&(b=this.Sk(b));var d=c.data("metadata");if(d){b.data=
c.data("data");b.datasource=this.options.data;for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e])}else b.key=this.nb(c),b.leaf=this.Go(c),b.depth=c.parents(".oj-treeview-list").length;return b},_setOption:function(a,b,d){var e=this;this._superApply(arguments);"expanded"==a?this.$l().each(function(){var a=g(this);e.spa(a)?e.ze(a,!0):e.qi(a,!0)}):"selection"==a?this.$l().each(function(){var a=g(this);e.Di(a)}):"currentItem"==a?this.t7():this.refresh()},_destroy:function(){this._super()}})})();a.J.Ua("oj-tree-view",
"baseComponent",{properties:{currentItem:{type:"any",readOnly:!0,writeback:!0},data:{},dnd:{type:"object",properties:{drag:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"Array\x3cstring\x3e"},drag:{},dragEnd:{},dragStart:{}}}}},drop:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"Array\x3cstring\x3e"},dragEnter:{},dragLeave:{},dragOver:{},drop:{}}}}}}},expanded:{writeback:!0},item:{type:"object",properties:{focusable:{},renderer:{},selectable:{}}},
selection:{type:"Array\x3cobject\x3e",writeback:!0},selectionMode:{type:"string",enumValues:["none","single","multiple"]}},events:{animateEnd:{},animateStart:{},beforeCollapse:{},beforeCurrentItem:{},beforeExpand:{},collapse:{},expand:{}},methods:{getContextByNode:{}},extension:{Ya:"ojTreeView"}});a.J.register("oj-tree-view",{metadata:a.J.getMetadata("oj-tree-view")})});