/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","promise","ojs/ojcomponentcore","ojs/ojpopupcore","ojs/ojanimation"],function(a,g){(function(){var c="oj-left oj-center oj-right oj-top oj-middle oj-bottom".split(" "),b={"right-top":"oj-right oj-top","right-middle":"oj-right oj-middle","right-bottom":"oj-right oj-bottom","left-top":"oj-left oj-top","left-middle":"oj-left oj-middle","left-bottom":"oj-left oj-bottom","center-top":"oj-center oj-top","center-middle":"oj-left oj-middle","center-bottom":"oj-center oj-bottom"};
a.ib("oj.ojPopup",g.oj.baseComponent,{widgetEventPrefix:"oj",options:{animation:null,autoDismiss:"focusLoss",chrome:"default",initialFocus:"auto",position:{my:{horizontal:"start",vertical:"top"},offset:{x:0,y:0},at:{horizontal:"start",vertical:"bottom"},of:void 0,collision:"flip"},tail:"none",modality:"modeless",role:"tooltip",beforeOpen:null,open:null,beforeClose:null,close:null,focus:null,animateStart:null,animateEnd:null},rc:function(){this._super();var b=this.element;b.hide().addClass("oj-popup").attr("aria-hidden",
"true");b.addClass("oj-component");var c=g("\x3cdiv\x3e");c.addClass("oj-popup-content");c.attr("role","presentation");c.append(b[0].childNodes);c.appendTo(b);this.nJ=c;this.Lsa();this.f8(b);b=this.options;b.position=a.Na.OV(b.position)},Pf:function(){this._super();this.element.uniqueId();this.zja()},_destroy:function(){a.U.ug(this.element)===a.U.Kd.OPEN&&this.sr();this.Ko("none");this.fka();delete this.Xp;var b=this.element;b.hide().attr("aria-hidden","true").removeUniqueId();var c=this.nJ;delete this.nJ;
b.append(c[0].childNodes);c.remove();if(b=this.ND)delete this.ND,b();this._super()},open:function(b,c){if(!this.gx("open",[b,c])){a.U.ug(this.element)===a.U.Kd.OPEN&&this.sr();this.UYa(b);var f=this.element;b=this.df;if(!1!==this._trigger("beforeOpen")){this.Ko("open");var g=this.options;c=c?c:g.position;c.of||(this.ioa=!0,c.of=b);this.ita(c);this.L7(g.autoDismiss);this.KHa();this.$()&&f[0].hasAttribute.role||f.attr("role",g.role);c=this.Qma();var k="oj-popup-layer",l=g.tail;"none"!==l&&(k+=" "+["oj-popup-tail",
l].join("-"));l={};l[a.fa.Ha.We]=f;l[a.fa.Ha.PC]=b;l[a.fa.Ha.rt]=c;l[a.fa.Ha.jt]=this.tE();l[a.fa.Ha.Xv]=k;l[a.fa.Ha.Pm]=g.modality;l[a.fa.Ha.pH]=this.$();a.fa.Xa().open(l)}}},$I:function(b){var c=b[a.fa.Ha.We];b=b[a.fa.Ha.rt];c.show();c.position(b);if((b=this.options.animation)&&b.open){var f=b.actionPrefix;return a.ca.Li(c[0],f?[f,"open"].join("-"):"open",a.Na.EV(c,b.open),this)}},QI:function(b){var c=b[a.fa.Ha.We];b=b[a.fa.Ha.PC];this.aTa();this._trigger("open");this.E5();this._on(c,{keydown:this.hx,
keyup:this.hx});b&&0<b.length&&this._on(b,{keydown:this.hx,keyup:this.hx})},close:function(){if(!this.gx("close",[])&&a.U.ug(this.element)===a.U.Kd.OPEN&&(!1!==this._trigger("beforeClose")||this.DA)){this.Ko("close");this.XXa();var b=this.df,c=this.element;this._off(c,"keydown keyup");b&&0<b.length&&this._off(b,"keydown keyup");this.VLa();b={};b[a.fa.Ha.We]=c;a.fa.Xa().close(b)}},ZI:function(b){var c=b[a.fa.Ha.We];b=this.options.animation;if(!this.DA&&b&&b.close){var f=c.attr("style"),g=b.actionPrefix;
return a.ca.Li(c[0],g?[g,"close"].join("-"):"close",a.Na.EV(c,b.close),this).then(function(){c.attr("style",f);c.hide()})}c.hide()},Ot:function(){this.UWa();this.L7();delete this.df;this._trigger("close");this.ioa&&(this.options.position.of=null,delete this.ioa)},isOpen:function(){var b=a.U.ug(this.element);return b===a.U.Kd.xZ||b===a.U.Kd.OPEN||b===a.U.Kd.KY},refresh:function(){this._super();if(a.U.ug(this.element)===a.U.Kd.OPEN&&this.Zra()){var b=this.element;a.fa.Xa().sY(b,a.fa.uc.qt)}},_setOption:function(b,
c){var f=this.options;switch(b){case "tail":c!==f.tail&&this.oZa(c);break;case "chrome":c!==f.chrome&&this.Lsa(c);break;case "position":this.ita(c);this.refresh();return;case "autoDismiss":a.U.ug(this.element)===a.U.Kd.OPEN&&c!==f.autoDismiss&&this.L7(c);break;case "modality":a.U.ug(this.element)===a.U.Kd.OPEN&&(f={},f[a.fa.Ha.We]=this.element,f[a.fa.Ha.Pm]=c,a.fa.Xa().SF(f))}this._superApply(arguments)},X8a:function(){return"oj-popup"},oZa:function(a){this.fka();this.zja(a);this.Zra()},zja:function(b){b=
b?b:this.options.tail;if("none"!==b){b=["oj-popup-tail",b].join("-");var c=g("\x3cdiv\x3e").hide();c.addClass("oj-popup-tail").addClass(b);c.attr("role","presentation");this.lua=c.attr("id",this.n4("tail")).attr("id");var f=this.element;c.appendTo(f);f.addClass(b);a.U.ug(this.element)===a.U.Kd.OPEN&&(c={},c[a.fa.Ha.We]=f,c[a.fa.Ha.Xv]="oj-popup-layer "+b,a.fa.Xa().SF(c))}},ina:function(){var a=this.lua;return a?g(document.getElementById(a)):null},fka:function(){var b=this.ina();b&&b.remove();delete this.lua;
b=this.element;b.removeClass(["oj-popup-tail",this.options.tail].join("-"));if(a.U.ug(this.element)===a.U.Kd.OPEN){var c={};c[a.fa.Ha.We]=b;c[a.fa.Ha.Xv]="oj-popup-layer";a.fa.Xa().SF(c)}},Lsa:function(a){a=a?a:this.options.chrome;var b=this.element;"default"===a&&b.hasClass("oj-popup-no-chrome")?b.removeClass("oj-popup-no-chrome"):"none"!==a||b.hasClass("oj-popup-no-chrome")||b.addClass("oj-popup-no-chrome")},UYa:function(b){b?"string"===g.type(b)?b=g(b):1===b.nodeType&&(b=g(b)):b=g(document.activeElement);
if(b instanceof g&&1<b.length)for(var c=this.element,f=0;f<b.length;f++){var h=b[0];if(!a.Q.gy(c[0],h)){b=g(h);break}}else if(!(b instanceof g)||b instanceof g&&0===b.length)b=g(document.activeElement);this.df=b},ita:function(b){var c=this.options;b&&(c.position=a.Na.OV(b,c.position))},Qma:function(){var b=a.Na.I9(this.options.position),c="rtl"===this.Wc(),b=a.Na.Eq(b,c),c=b.using,c=g.isFunction(c)?c:null;b.using=this.yM.bind(this,c);return b},OXa:function(a){a();delete this.ND;this.sr()},NXa:function(a,
b){window.clearTimeout(a);b()},yM:function(d,e,f){var g=f.element.element;if(e.top!==g.css("top")||e.left!==g.css("left")){var k=this.ina();if(k){k.hide();for(var l=0;l<c.length;l++)k.removeClass(c[l]),g.removeClass(c[l]);k.removeAttr("style");if(f.target&&0===f.target.height&&0===f.target.width&&(l="rtl"===this.Wc(),l=a.Na.Eq(this.options.position,l).my,!a.ab.So(l))){var m="center"===l.vertical?"middle":l.vertical;f.horizontal="center"===l.horizontal?l.horizontal:f.horizontal;f.vertical=m}l=b[[f.horizontal,
f.vertical].join("-")];k.addClass(l);g.addClass(l);k.show();"left"===f.horizontal?(l=k.outerWidth(),l-=l+a.Q.pq(k.css("left")),e.left+=l-2):"right"===f.horizontal&&(l=k.outerWidth(),l-=l+a.Q.pq(k.css("right")),e.left-=l-2);"top"===f.vertical?(l=k.outerHeight(),l-=l+a.Q.pq(k.css(f.vertical)),e.top+=l-2):"bottom"===f.vertical&&(l=k.outerHeight(),l-=l+a.Q.pq(k.css(f.vertical)),e.top-=l-2);g.css(e);"center"===f.horizontal&&"middle"!==f.vertical?(l=g.width(),l=Math.round((l/2-k.outerWidth()/2)/l*100),
k.css({left:l+"%"})):"middle"===f.vertical&&(l=g.height(),l=Math.round((l/2-k.outerHeight()/2)/l*100),k.css({top:l+"%"}))}else g.css(e);a.Na.zva(g,f);d&&d(e,f);"focusLoss"===this.options.autoDismiss&&a.Na.gaa(f)&&(this.w5=!0,d=a.Context.getContext(this.element[0]).Dc(),e={description:["ojPopup identified by '",this.element.attr("id"),"' is pending implicit closure."].join("")},d=d.Xc(e),e=window.setTimeout(this.OXa.bind(this,d),0),this.ND=this.NXa.bind(this,e,d))}},Zra:function(){var b=this.element,
c=this.Qma();if(a.ab.Gd(c.of)){var f=g(c.of);if(0===f.length)return!1;c.of=f}b.position(c);return!0},E5:function(b){var c=this.Xja();b&&"none"===c&&(c="popup");if("firstFocusable"===c){b=this.nJ.find(":focusable");for(var f,g=0;g<b.length;g++)if(a.yf.zG(b[g])){f=b[g];break}f?(f.focus(),this._trigger("focus")):c="popup"}"popup"===c&&(c=this.element,c.attr("tabindex","-1"),(f=this.O1)?f.getLink().focus():c.focus(),this._trigger("focus"))},Xja:function(){var b=this.options,c=b.initialFocus;"auto"===
c&&(c="modal"===b.modality?a.Q.qe()?"popup":"firstFocusable":"none");return c},xT:function(b,c){b||(b=document.activeElement);if(!b)return!1;var f=this.element;c&&(f=f.parent());return a.Q.gy(f[0],b)},mpa:function(b){b||(b=document.activeElement);return a.Q.gy(this.df[0],b)},XXa:function(){this.w5?delete this.w5:this.xT(null,!0)&&this.df.focus()},hx:function(a){if(!a.isDefaultPrevented()){var b=a.type,c=this.nJ,h=a.target;if("keyup"===b&&a.keyCode===g.ui.keyCode.ESCAPE&&(this.xT(h)||this.mpa(h)))a.preventDefault(),
this.close();else if("keydown"===b&&117===a.keyCode)this.xT(h)?(h=this.options,"modeless"===h.modality?(a.preventDefault(),a=this.df,a.focus()):this.close()):this.mpa(h)&&(a.preventDefault(),this.E5(!0));else if("keydown"===b&&a.keyCode===g.ui.keyCode.TAB&&this.xT(h))if(c=c.find(":tabbable"),0<c.length){var b=c[0],c=c[c.length-1],k=this.element;b!==h&&k[0]!==h||!a.shiftKey?c!==h||a.shiftKey||(a.preventDefault(),c===b?(k.attr("tabindex","-1"),k.focus()):g(b).focus()):(a.preventDefault(),b===c&&b===
h?(k.attr("tabindex","-1"),k.focus()):g(c).focus())}else a.preventDefault(),h=this.options,"modeless"===h.modality?(a=this.df,a.focus()):this.close()}},L7:function(b){var c=this.dla,f=this.tE();c&&(delete f[a.fa.uc.SC],delete this.dla);"focusLoss"===b&&(c=this.dla=this.eMa.bind(this),f[a.fa.uc.SC]=c);a.U.ug(this.element)===a.U.Kd.OPEN&&(b={},b[a.fa.Ha.We]=this.element,b[a.fa.Ha.jt]=f,a.fa.Xa().SF(b))},eMa:function(b){if(a.U.ug(this.element)===a.U.Kd.OPEN){var c=this.df,f=this.element.parent(),g=b.target,
k=this.d3;if(k&&(k=k.getLink())&&a.Q.gy(k[0],g))return;if(!a.Q.gy(c[0],g)&&!a.Q.gy(f[0],g)){if(a.yf.zG(g)){if("mousedown"===b.type||"touchstart"===b.type)return;this.w5=!0}this.close()}}},KHa:function(){var a=this.df,b=this.element.attr("id"),c=a.attr("aria-describedby"),c=c?c.split(/\s+/):[];c.push(b);c=g.trim(c.join(" "));a.attr("aria-describedby",c)},UWa:function(){var a=this.df,b=this.element;if(a&&0!==a.length){var b=b.attr("id"),c=a.attr("aria-describedby"),c=c?c.split(/\s+/):[],b=g.inArray(b,
c);-1!==b&&c.splice(b,1);(c=g.trim(c.join(" ")))?a.attr("aria-describedby",c):a.removeAttr("aria-describedby")}},aTa:function(){var b=a.Ja.rl().os===a.Ja.Jl.TO||a.Ja.rl().os===a.Ja.Jl.AY,c=this.c6;c||(c=this.c6=new a.ii);var f;f=this.Xja();f=b?this.T("none"===f?"ariaLiveRegionInitialFocusNoneTouch":"ariaLiveRegionInitialFocusFirstFocusableTouch"):this.T("none"===f?"ariaLiveRegionInitialFocusNone":"ariaLiveRegionInitialFocusFirstFocusable");c.v0a(f);if(b){var c=this.n4("focusSkipLink"),g=this.df,b=
this.E5.bind(this,!0);f=this.T("ariaFocusSkipLink");this.d3=new a.Gj(g,f,b,c);c=this.nJ;g=this.n4("closeSkipLink");b=this.sr.bind(this);f=this.T("ariaCloseSkipLink");this.O1=new a.Gj(c,f,b,g)}},VLa:function(){this.c6.destroy();delete this.c6;var a=this.d3;a&&(a.destroy(),delete this.d3);if(a=this.O1)a.destroy(),delete this.O1},n4:function(b){var c=this.element.attr("id");a.ab.So(c)&&(c=this.uuid);return[c,b].join("_")},nB:function(){this.element.remove()},tE:function(){if(!this.Xp){var b=this.Xp=
{};b[a.fa.uc.TC]=this.sr.bind(this);b[a.fa.uc.UC]=this.nB.bind(this);b[a.fa.uc.qt]=this.refresh.bind(this);b[a.fa.uc.hP]=this.$I.bind(this);b[a.fa.uc.fP]=this.QI.bind(this);b[a.fa.uc.gP]=this.ZI.bind(this);b[a.fa.uc.eP]=this.Ot.bind(this)}return this.Xp},sr:function(){this.DA=!0;this.close();delete this.DA},Ko:function(b){var c=this.fq;c&&(c.destroy(),delete this.fq);0>["open","close"].indexOf(b)||(this.fq=new a.Rm(this.element,b,"ojPopup",this.$()))},gx:function(a,b){var c=this.fq;return c?c.laa(this,
a,a,b):!1},f8:function(a){var b=this;this._focusable({applyHighlight:!0,setupHandlers:function(c,h){b._on(a,{focus:function(a){c(g(a.currentTarget))},blur:function(a){h(g(a.currentTarget))}})}})},Ih:function(){a.U.ug(this.element)===a.U.Kd.OPEN&&this.sr();this._super()}});a.Components.Kq({ojPopup:{modality:a.Components.Ff(function(){return(a.ic.ad("oj-popup-option-defaults")||{}).modality}),animation:a.Components.Ff(function(){return(a.ic.ad("oj-popup-option-defaults")||{}).animation})}})})();a.J.Ua("oj-popup",
"baseComponent",{properties:{autoDismiss:{type:"string",enumValues:["focusLoss","none"]},chrome:{type:"string",enumValues:["default","none"]},initialFocus:{type:"string",enumValues:["auto","none","firstFocusable","popup"]},modality:{type:"string",enumValues:["modeless","modal"]},position:{type:"object",properties:{my:{type:"object|string",properties:{horizontal:{type:"string",enumValues:["start","end","left","center","right"]},vertical:{type:"string",enumValues:["top","center","bottom"]}}},at:{type:"object|string",
properties:{horizontal:{type:"string",enumValues:["start","end","left","center","right"]},vertical:{type:"string",enumValues:["top","center","bottom"]}}},offset:{type:"object",properties:{x:{type:"number"},y:{type:"number"}}},of:{type:"string|object"},collision:{type:"string",enumValues:["flip","fit","flipfit","flipcenter","none"]}}},tail:{type:"string",enumValues:["simple","none"]}},events:{beforeOpen:{},open:{},beforeClose:{},close:{},focus:{},animateStart:{},animateEnd:{}},methods:{close:{},isOpen:{},
open:{}},extension:{Ya:"ojPopup"}});a.J.register("oj-popup",{metadata:a.J.getMetadata("oj-popup")})});