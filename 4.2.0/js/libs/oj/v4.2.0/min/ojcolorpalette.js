/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojarraytabledatasource","ojs/ojcolor","ojs/ojlistview","ojs/ojeditablevalue"],function(a,g){(function(){a.ib("oj.ojColorPalette",g.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{labelledBy:null,palette:null,swatchSize:"lg",labelDisplay:"off",layout:"grid",value:null},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var b=a.subId,d=a.index;a=this._super(a);if(!a)switch(b){case "oj-palette-entry":b=
this.oe.find(".oj-listview-item"),b.length&&d<b.length&&(a=b[d])}return a},getSubIdByNode:function(a){var b=g(a),d=null,e=-1,f=null,h;b.is("li")&&b.hasClass("oj-listview-item-element")&&(d="oj-palette-entry",h=b.attr("id"),b=this.oe.find(".oj-listview-item"),g.each(b,function(a,b){if(g(b).attr("id")===h)return e=a,!1}));d&&(f={subId:d},0<=e&&(f.index=e));null==f&&(f=this._super(a));return f},add:function(c){var b=null,d;c instanceof a.o?b={color:c}:"object"===typeof c&&(d=c.color,d instanceof a.o&&
(b=c));b&&(this.RU("The swatch add is being animated in the palette (id\x3d"+this.element.attr("id")+")."),b.id=this.Dma(),this.An||(this.An=[]),this.An.push({yg:"a",MX:b}),this.XE.add(b),this.m9())},remove:function(c){var b=null,d;d=typeof c;"number"===d?0<=c&&c<this.$j.length?b=this.$j[c].id:a.D.error("JET Color Palette (id\x3d'"+this.element.attr("id")+"'): Invalid index for remove ("+c+")"):"object"===d&&(c=c instanceof a.o?c:c.color,b=this.nNa(c));b&&(c={id:b},this.RU("The removed swatch is being animated in the palette (id\x3d"+
this.element.attr("id")+")."),this.An||(this.An=[]),this.An.push({yg:"r",MX:c}),this.XE.remove(c),this.m9())},whenReady:function(){var a=this;return new Promise(function(b){a.oe.ojListView("whenReady").then(function(){b(!0)})})},_destroy:function(){this.z7();this.oe&&(this.An=[],this.oe.ojListView("destroy"));this.XE=null;this.dea.remove();this.Fh.removeClass("oj-colorpalette");this.Yz();this._super()},rc:function(){this._super();this.QSa()},Pf:function(){var c;this._super();this.hk(null,this.options.labelledBy,
this.oe);this.$()||(c=this.wz());c?(c=c.attr("id"))?this.oe.attr("aria-labelledby",c):a.D.warn("JET Color Palette: The label for this component needs an id in order to be accessible"):(c=this.element.attr("aria-label"))&&this.oe.attr("aria-label",c)},_setOption:function(a,b,d){var e=this.options.labelledBy;switch(a){case "value":this.W7(b);break;case "palette":this.$Ya(b);break;case "swatchSize":this.aZa(b);break;case "layout":this.ZYa(b);break;case "labelDisplay":this.YYa(b);break;case "disabled":this.aM(b,
!0);break;case "labelledBy":this.hk(e,b,this.oe)}this._super(a,b,d)},hk:a.ka.hk,nVa:function(a,b){"selection"===b.option&&this.lYa(a,b)},m9:function(){if(!this.E_){var c=this;this.E_=a.Context.getContext(this.oe[0]).Dc();this.E_.whenReady().then(function(){c.E_=null;var a,d,e,f,g;c.z7();if(c.An){e=!1;for(g=0;g<c.An.length;g++)if(a=c.An[g],d=a.MX,"a"===a.yg||"r"===a.yg)e=!0,f||(f=c.$j.slice(0)),"a"===a.yg?f.push(d):"r"===a.yg&&(d=c.mNa(f,d.id),f.splice(d,1),a.index=d);if(e)for(c.iA("palette",f,null);c.An.length;)a=
c.An.shift(),d=a.MX,"a"===a.yg?c.$j.push(d):"r"===a.yg&&c.$j.splice(a.index,1)}},function(){a.D.error("JET Color Palette (id\x3d'"+c.element.attr("id")+"'): ListView timed out.");c.An=[]})}},eR:function(c,b){var d=b instanceof a.o,e=!1;c instanceof a.o&&d&&(e=c.isEqual(b));return e},iA:function(a,b,d){"palette"===a&&this.option(a,b,{_context:{originalEvent:d,Sa:!0},changed:!0})},S2:function(a){var b=-1,d=this.$j,e=d.length,f,g;for(f=0;f<e;f++)if(g=d[f],a.isEqual(g.color)){b=f;break}return b},nNa:function(a){var b=
null,d=this.$j,e=d.length,f,g;for(f=0;f<e;f++)if(g=d[f],a.isEqual(g.color)){b=g.id;break}return b},mNa:function(a,b){var d=-1,e=a.length,f,g;for(f=0;f<e;f++)if(g=a[f],g.id===b){d=f;break}return d},RU:function(c){this.AU||(this.AU=a.Context.getContext(this.element[0]).Dc().Xc({description:c}))},z7:function(){this.AU&&(this.AU(),this.AU=null)},FXa:function(c){var b,d,e,f,g,k;b=c.data.color;b instanceof a.o||(b=a.o.BLACK,a.D.warn("JET Color Palette (id\x3d'"+this.element.attr("id")+"'): Substituting oj.Color.BLACK for an object that is not an instance of oj.Color"));
d=e=c.data.label;f="auto"===this.HT&&"list"===this.og&&"sm"===this.yF||"auto"===this.HT&&"grid"===this.og&&"lg"===this.yF;null!=b&&(k=d?d:this.S1.format(b),f?(d=k?k:this.S1.format(b),d=e?d:d.toUpperCase()):d=null,g=!!(this.UTa(b)||d&&"none"===d.toLowerCase()));e="";this.xn===c.data.id&&(e="oj-selected",this.xn=-1,this.J7=c.parentElement);c="list"===this.og?"oj-colorpalette-swatchsize-"+this.yF+(g?" oj-colorpalette-swatch-none":""):this.cua+(g?" oj-colorpalette-swatch-none":"");return g?this.BXa(f,
d,k,c,e):this.DXa(b,f,d,k,c,e)},DXa:function(a,b,d,e,f,h){a="\x3cdiv class\x3d'oj-colorpalette-swatch-entry "+f+(b?" oj-colorpalette-swatch-showlabel":"")+"'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-container'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch "+h+"' style\x3d'background-color:"+a.toString()+"'"+(d?"":" title\x3d'"+e+"'")+"\x3e\x3c/div\x3e\x3c/div\x3e";d&&(a+="\x3cspan class\x3d'oj-colorpalette-swatch-text'\x3e"+d+"\x3c/span\x3e");return g(a+"\x3c/div\x3e")[0]},BXa:function(a,b,d,e,f){a=
"\x3cdiv class\x3d'oj-colorpalette-swatch-entry "+e+(a?" oj-colorpalette-swatch-showlabel":"")+"'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-container'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch "+f+"'"+(b?"":" title\x3d'"+d+"'")+"\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-none-icon'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";b&&(a+="\x3cspan class\x3d'oj-colorpalette-swatch-text'\x3e"+b+"\x3c/span\x3e");return g(a+"\x3c/div\x3e")[0]},lYa:function(a,b){var d=null,e,f;e=g(b.items[0]).find(".oj-colorpalette-swatch");
e.addClass("oj-selected");f=this.nYa;this.nYa=e;!f&&this.J7&&(f=g(this.J7).find(".oj-colorpalette-swatch"),this.J7=null);f&&f.removeClass("oj-selected");if(1===b.value.length){for(e=0;e<this.$j.length;e++)if(this.$j[e].id===b.value[0]){d=this.$j[e].color;break}this.jc(d,a);this.$f=d}},aM:function(a,b){var d,e;if(!b||b&&a!==this.zr)this.oe&&this.oe.ojListView("option","disabled",a),d=g(".oj-colorpalette-container .oj-colorpalette-swatch"),e=this,a?(this.BJ=[],g.each(d,function(a,b){e.BJ.push(b.style.backgroundColor);
b.style.backgroundColor="#eee"})):(this.BJ&&this.BJ.length&&g.each(d,function(a,b){b.style.backgroundColor=e.BJ[a]}),this.BJ=null),this.zr=a},W7:function(c){var b=-1,d=[];0<this.$j.length&&c instanceof a.o&&!this.eR(this.$f,c)&&(b=this.S2(c),0<=b&&d.push(b),this.oe.ojListView("option","selection",d),this.$f=c);return 0<=b},$Ya:function(a){g.isArray(a)&&!this.MTa(a,this.$j)&&(this.RU("The palette (id\x3d"+this.element.attr("id")+") option change in progress."),this.An=[],this.$j=a.slice(0),this.xn=
this.S2(this.$f),this.Rsa(a,this.xn,!0),this.m9())},aZa:function(a){"string"===typeof a&&a!==this.yF&&(this.yF=a,this.cua="oj-colorpalette-swatchsize-"+("lg"===a?"lg":"sm"===a?"sm":"xs"),this.oe.ojListView("refresh"))},YYa:function(a){"string"!==typeof a||a===this.HT||"auto"!==a&&"off"!==a||(this.HT=a,this.oe.ojListView("refresh"))},ZYa:function(a){"string"===typeof a&&a!==this.og&&(this.og=a,this.xYa(),this.oe.ojListView("refresh"))},xYa:function(){var a="grid"===this.og,b=a?"oj-colorpalette-grid":
"oj-colorpalette-list";this.oe.removeClass("oj-colorpalette-grid oj-colorpalette-list oj-listview-card-layout");this.oe.addClass(b);a&&this.oe.addClass("oj-listview-card-layout")},Rsa:function(c,b,d){this.THa(c);this.XE=new a.hb(c,{idAttribute:"id"});0<=b&&(this.$j[b].id&&(b=this.$j[b].id),0===this.XT.length?this.XT.push(b):this.XT[0]=b);d&&this.oe.ojListView("option","data",this.XE)},QSa:function(){this.RU("Palette (id\x3d"+this.element.attr("id")+") is initializing.");this.AK();this.qb()},qb:function(){this.Fh.append(this.YK);
this.Fh.addClass("oj-colorpalette");this.dea=this.Fh.find(".oj-colorpalette-container");this.oe=this.dea.find(":first");this.oe.attr("data-oj-context","");this.$f&&this.$f instanceof a.o&&(this.xn=this.S2(this.$f));this.dua=0;this.Rsa(this.$j,this.xn,!1);this.oe.ojListView({data:this.XE,item:{renderer:this.FXa.bind(this)},optionChange:this.nVa.bind(this),selectionMode:"single",selection:this.XT,rootAttributes:{style:"height:100%;width:100%"}}).attr("data-oj-internal","");var c=this;a.Context.getContext(this.oe[0]).Dc().whenReady().then(function(){c.oe.ojListView("option",
"translations.msgNoData","");c.aM(c.zr);if(c.oe[0].scrollWidth>c.oe[0].clientWidth){var a=c.CPa(),d="rtl"===c.Wc();c.oe.css(d?"padding-left":"padding-right",a+1)}c.z7()})},AK:function(){this.Y0();this.gja=a.Oa.kl(a.ci.CONVERTER_TYPE_COLOR);this.S1=this.gja.createConverter({format:"hex"});this.T("labelNone");this.YK=["\x3cdiv class\x3d'oj-colorpalette-container'\x3e","\x3cul class\x3d'"+("grid"===this.og?"oj-colorpalette-grid oj-listview-card-layout":"oj-colorpalette-list")+"'/\x3e","\x3c/div\x3e"].join("")},
Y0:function(){var c=this.options,b;this.Fh=g(this.element);this.zr=!1;this.XT=[];this.XE=null;b=c.swatchSize;"string"===typeof b&&(b=b.toLowerCase(),"lg"!==b&&"sm"!==b&&"xs"!==b&&(b="lg"));this.yF=b;this.cua="oj-colorpalette-swatchsize-"+b;b=c.labelDisplay;"string"===typeof b&&(b=b.toLowerCase(),"auto"!==b&&"off"!==b&&(b="auto"));this.HT=b;b=c.layout;"string"===typeof b&&(b=b.toLowerCase(),"grid"!==b&&"list"!==b&&(b="grid"),"grid"!==b&&"xs"===this.yF&&(b="grid"));this.og=b;b=c.value;b instanceof a.o||
(b=null);this.$f=b?b:a.o.BLACK;b=c.palette;g.isArray(b)||(b=[]);this.$j=b.slice(0);b=c.disabled;"boolean"===typeof b&&(this.zr=b)},UTa:function(a){var b=a.kG(),d=a.bG(),e=a.ZF();a=a.YF();return 0===b&&0===d&&0===e&&0===a},MTa:function(a,b){var d=a.length,e=b.length,f,g;f=!1;if(d===e){for(e=0;e<d&&(f=a[e],g=b[e],!this.eR(f.color,g.color)||(f=f.label,g=g.label,f===g));e++);f=e>=d}return f},THa:function(a){var b,d,e=a.length;for(b=0;b<e;b++)d=a[b],d.id=this.Dma()},Dma:function(){var a=this.dua.toString();
this.dua++;return a},Yz:function(){this.gja=this.S1=this.YK=this.oe=null},CPa:function(){var a=g("\x3cdiv style\x3d'overflow: scroll; width: 100px; height: 100px; position: absolute; visibility: hidden;'\x3e\x3cdiv style\x3d'width: 100%; height: 100%;'\x3e\x3c/div\x3e\x3c/div\x3e");this.element.append(a);var b=a[0].offsetWidth,d=a.children()[0].offsetWidth;a.remove();return b-d},_GetMessagingLauncherElement:function(){return this.element},xe:function(){return this.oe},gw:function(){return this.$f},
Uk:function(c){this.$f="string"===typeof c?new a.o(c):c},$i:function(){return this.$f.toString()},_GetDefaultStyleClass:function(){return"oj-colorpalette"}})})();a.J.Ua("oj-color-palette","editableValue",{properties:{labelDisplay:{type:"string",enumValues:["auto","off"]},labelledBy:{type:"string"},layout:{type:"string",enumValues:["grid","list"]},palette:{type:"Array"},swatchSize:{type:"string",enumValues:["lg","sm","xs"]},value:{writeback:!0}},extension:{Ya:"ojColorPalette"}});a.J.register("oj-color-palette",
{metadata:a.J.getMetadata("oj-color-palette")})});