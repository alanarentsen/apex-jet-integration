/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","promise","ojs/ojdeferreddataprovider","ojs/ojarraydataprovider"],function(a){var g={};a.f.ua(g,a.f,"ChartDataProviderUtils");a.L7a=g;g.s1a=function(c,b){var d={},e={},f=b.itemProperties,h=b.seriesProperties,k=b.seriesComparator,l=b.groupProperties,m=b.groupComparator,n=c.fetchFirst({size:-1})[Symbol.asyncIterator]().next().then(function(a){return new Promise(function(b){var c=a.value,d=c.data,c=c.metadata.map(function(a){return a.key});b({data:d,keys:c})})}).then(function(a){var b=
a.data;a=a.keys;for(var h=0,k=0,l=[],m=0;m<b.length;m++){var n=b[m],t=a[m],y=f({data:n,key:t,datasource:c});l.push(y);var z=y.seriesId;d[z]?(d[z].data.push(n),d[z].keys.push(t)):(d[z]={id:z,datasource:c,data:[n],keys:[t],index:h},h++);y=y.groupId;z=k;e[y.slice(0,y.length-1)]||k++;e=g.pha(e,n,t,y,c,0,z)}return l}),t=n.then(function(){return new Promise(function(a){var b=[];Object.keys(d).forEach(function(a){b.push({id:a,name:a})});k&&b.sort(function(a,b){return function(c,d){return b(a[c.id],a[d.id])}}(d,
k));if(k||h)for(var c=0;c<b.length;c++){var e=b[c].id;k&&(d[e].index=c);if(h){var f=h(d[e]);f.id||(f.id=e);f.name||(f.name=e);b[c]=f}}a(b)})}),n=n.then(function(a){a=g.TKa(a,d);m&&(a=g.Sta(a,e,m,[]));l&&(a=g.Ysa(a,e,l,[]));return a}).then(function(b){return new a.ArrayDataProvider(b)}),n=new a.DeferredDataProvider(n,a.ArrayDataProvider.getCapability);return{series:t,groups:n}};g.pha=function(a,b,d,e,f,h,k){if(h<e.length){var l=e.slice(0,h+1),m=a[l];m?(m.data.push(b),m.keys.push(d)):a[l]={ids:l,datasource:f,
data:[b],keys:[d],depth:h,leaf:h==e.length-1,index:k};k=m?m.data.length-1:0;a=g.pha(a,b,d,e,f,h+1,k)}return a};g.TKa=function(a,b){for(var d=[],e=0;e<a.length;e++)var f=a[e],d=g.eha(f,f.groupId,d,b);return d};g.eha=function(a,b,d,e){d||(d=[]);for(var f=b[0],h=null,k=0;k<d.length;k++)d[k].id==f&&(h=k);null!=h?f=d[h]:(f={id:f,name:f},d.push(f));if(1<b.length)f.groups=g.eha(a,b.slice(1),f.groups,e);else{if(!f.items)for(f.items=[],b=Object.keys(e||{}).length,k=0;k<b;k++)f.items.push(null);f.items[e[a.seriesId].index]=
a;delete a.seriesId;delete a.groupId}return d};g.Sta=function(a,b,d,e){e||(e=[]);a.sort(function(a,b,c){return function(d,e){return b(a[c.concat(d.id)],a[c.concat(e.id)])}}(b,d,e));for(var f=0;f<a.length;f++){var h=e.concat(a[f].id);b[h].index=f;a[f].groups&&(a[f].groups=g.Sta(a[f].groups,b,d,h))}return a};g.Ysa=function(a,b,d,e){for(var f=0;f<a.length;f++){var h=a[f],k=e.concat(h.id),l=d(b[k]);Object.keys(l).forEach(function(a){h[a]=l[a]});h.groups&&(h.groups=g.Ysa(h.groups,b,d,k))}return a};return{createChartData:g.s1a}});