/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","knockout","ojs/ojdatasource-common","ojs/ojmodel","ojs/ojknockout-model"],function(a,g,c){a.Mc=function(a){this.zb=a;this.current=0;this.Init();this.mk=[];this.Y7(10)};o_("CollectionPagingDataSource",a.Mc,a);a.f.ua(a.Mc,a.Wn,"oj.CollectionPagingDataSource");a.Mc.prototype.Init=function(){a.Mc.N.Init.call(this)};a.f.j("CollectionPagingDataSource.prototype.Init",{Init:a.Mc.prototype.Init});a.Mc.prototype.l4=function(){return this.fm()?this.$u:this.totalSize()-this.current};
a.Mc.prototype.$A=function(){this.mk=Array(this.l4());var a=this;return this.zb.OC(this.current,this.current+this.mk.length).then(function(c){for(var e=0;e<c.length;e++)a.mk[e]=c[e];a.DL();a.sn=a.oa+a.mk.length-1})};a.Mc.prototype.DL=function(){if(void 0!==this.Fq){this.Fq.removeAll();for(var b=0;b<this.mk.length;b++)this.Fq.push(a.Ib.map(this.mk[b]))}};a.Mc.prototype.mv=function(){return this.mk};a.f.j("CollectionPagingDataSource.prototype.getWindow",{mv:a.Mc.prototype.mv});a.Mc.prototype.kN=function(){void 0===
this.Fq&&(this.Fq=c.observableArray(),this.DL());return this.Fq};a.f.j("CollectionPagingDataSource.prototype.getWindowObservable",{kN:a.Mc.prototype.kN});a.Mc.prototype.getPage=function(){return this.ef};a.f.j("CollectionPagingDataSource.prototype.getPage",{getPage:a.Mc.prototype.getPage});a.Mc.prototype.setPage=function(b,c){c=c||{};b=parseInt(b,10);try{a.Mc.N.handleEvent.call(this,a.hi.ga.BEFOREPAGE,{page:b,previousPage:this.ef})}catch(e){return Promise.reject(null)}this.pageSize=null!=c.pageSize?
c.pageSize:this.pageSize;c.startIndex=b*this.pageSize;var f=this.ef;this.ef=b;this.oa=c.startIndex;var g=this;return new Promise(function(b,e){g.si(c).then(function(){a.Mc.N.handleEvent.call(g,a.hi.ga.PAGE,{page:g.ef,previousPage:f});b(null)},function(){g.ef=f;g.oa=g.ef*g.pageSize;e(null)})})};a.f.j("CollectionPagingDataSource.prototype.setPage",{setPage:a.Mc.prototype.setPage});a.Mc.prototype.getStartItemIndex=function(){return this.oa};a.f.j("CollectionPagingDataSource.prototype.getStartItemIndex",
{getStartItemIndex:a.Mc.prototype.getStartItemIndex});a.Mc.prototype.getEndItemIndex=function(){return this.sn};a.f.j("CollectionPagingDataSource.prototype.getEndItemIndex",{getEndItemIndex:a.Mc.prototype.getEndItemIndex});a.Mc.prototype.getPageCount=function(){var a=this.totalSize();return-1==a?-1:Math.ceil(a/this.pageSize)};a.f.j("CollectionPagingDataSource.prototype.getPageCount",{getPageCount:a.Mc.prototype.getPageCount});a.Mc.prototype.fetch=function(a){var c=a||{};if(void 0!==c.pageSize&&void 0!==
c.startIndex){if(!this.fm())return this.cU(null),Promise.resolve();this.$u=c.startIndex+c.pageSize;var e=this;return this.$A().then(function(){e.cU(null)})}return this.si(a)};a.f.j("CollectionPagingDataSource.prototype.fetch",{fetch:a.Mc.prototype.fetch});a.Mc.prototype.si=function(a){var c=a||{};void 0!==c.startIndex&&(this.current=c.startIndex);void 0!==c.pageSize&&(this.$u=this.pageSize=c.pageSize);var e=this;return new Promise(function(a){try{e.zb.fetch({success:function(){e.$A().then(function(){e.cU(c);
a({data:e.mv(),startIndex:e.current})})}})}catch(b){e.$A().then(function(){e.cU(c);a({data:e.mv(),startIndex:e.current})})}})};a.Mc.prototype.cU=function(a){a=a||{};a.silent||this.handleEvent("sync",{data:this.mv(),startIndex:this.current});a.success&&a.success()};a.Mc.prototype.handleEvent=function(b,c){return a.Mc.N.handleEvent.call(this,b,c)};a.Mc.prototype.fm=function(){return this.current+this.$u<this.totalSize()};a.Mc.prototype.Y7=function(a){this.$u=this.pageSize=a};a.Mc.prototype.size=function(){var a=
this.mv();return a?a.length:0};a.f.j("CollectionPagingDataSource.prototype.size",{size:a.Mc.prototype.size});a.Mc.prototype.totalSize=function(){return this.zb.length};a.f.j("CollectionPagingDataSource.prototype.totalSize",{totalSize:a.Mc.prototype.totalSize});a.Mc.prototype.totalSizeConfidence=function(){return"actual"};a.f.j("CollectionPagingDataSource.prototype.totalSizeConfidence",{totalSizeConfidence:a.Mc.prototype.totalSizeConfidence});a.Mc.prototype.getCapability=function(){return null};a.f.j("CollectionPagingDataSource.prototype.getCapability",
{getCapability:a.Mc.prototype.getCapability})});