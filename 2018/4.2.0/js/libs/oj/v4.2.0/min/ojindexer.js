/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","hammerjs","promise","ojs/ojjquery-hammer","ojs/ojcomponentcore"],function(a,g,c){a.Sq=function(){};o_("IndexerModel",a.Sq,a);a.Sq.SECTION_OTHERS={id:"__others__",label:a.Aa.T("oj-ojIndexer.indexerOthers")};o_("IndexerModel.SECTION_OTHERS",a.Sq.SECTION_OTHERS,a);a.Il=function(b){this.ya=b;this.Init()};o_("ListViewIndexerModel",a.Il,a);a.f.ua(a.Il,a.Gl,"oj.ListViewIndexerModel");a.Il.prototype.getIndexableSections=function(){return this.ya.ea.T("indexerCharacters").split("|")};
a.f.j("ListViewIndexerModel.prototype.getIndexableSections",{getIndexableSections:a.Il.prototype.getIndexableSections});a.Il.prototype.getMissingSections=function(){null==this.Eza&&(this.Eza=this.TOa());return this.Eza};a.f.j("ListViewIndexerModel.prototype.getMissingSections",{getMissingSections:a.Il.prototype.getMissingSections});a.Il.prototype.TOa=function(){var b=[],a,c,f,h,k,l;a=this.ya.bK();if(null!=a)for(c=this.getIndexableSections(),f=0;f<c.length;f++)h=c[f],k=!1,a.each(function(){l=g(this).text();
if(0<l.length&&l.charAt(0)==h)return k=!0,!1}),k||b.push(h);return b};a.Il.prototype.setSection=function(b){return b==a.Sq.SECTION_OTHERS?this.bZa():this.jZa(b)};a.f.j("ListViewIndexerModel.prototype.setSection",{setSection:a.Il.prototype.setSection});a.Il.prototype.bZa=function(){var b,c=this,e,f,h,k,l;b=this.getIndexableSections();return new Promise(function(m){e=null;f=c.ya.bK();null!=f&&f.each(function(){h=g(this).text();for(k=0;k<b.length;k++)if(l=b[k],0==h.indexOf(l))return!0;e=this;return!1});
e?(c.ya.G7(e),m(a.Sq.SECTION_OTHERS)):m(null)})};a.Il.prototype.jZa=function(b){var a,c,f=this,g=null,k;a=this.getIndexableSections();c=a.indexOf(b);return new Promise(function(l){if(-1==c)l(null);else{for(;c<a.length;){b=a[c];k=f.kNa(b);if(null!=k){f.ya.G7(k);g=b;break}c++}l(g)}})};a.Il.prototype.kNa=function(b){var a,c,f;c=this.ya.bK();null!=c&&c.each(function(){f=g(this).text();if(0==f.indexOf(b))return a=this,!1});return a};(function(){a.ib("oj.ojIndexer",g.oj.baseComponent,{defaultElement:"\x3cul\x3e",
version:"1.2",widgetEventPrefix:"oj",options:{data:null},rc:function(){this._super();this.qb()},Pf:function(){this._super();this.mja();this.kF();this.cLa()},_destroy:function(){this._super();this.JF();this.element.removeClass("oj-component-initnode");a.Q.unwrap(this.element,this.ju())},_setOption:function(b,a){this._superApply(arguments);"data"==b&&this.refresh()},Bp:function(){this._super();var b=this.ju()[0];this.Zr(b);this.JWa(b)},Ap:function(){this._super();var b=this.ju()[0];this.Mo(b);this.F_a(b);
this.tm&&(this.tm(null),this.tm=null)},widget:function(){return this.ju()},refresh:function(){this._super();this.element.empty();this.mja();this.kF();this.oy=null},getNodeBySubId:function(b){var a,c,f,h,k;if(null==b)return this.element?this.element[0]:null;if("oj-indexer-section"===b.subId)for(b=b.section,a=this.element.children("li"),c=0;c<a.length;c++){h=a.get(c);f=g(h).data("data-range");if(f==b)return h;k=g(h).data("data-includes");if(null!=k)for(f=0;f<k.length;f++)if(k[f]==b)return h}return null},
getSubIdByNode:function(b){return null!=b&&(b=g(b).data("data-range"),null!=b)?{subId:"oj-indexer-section",section:b}:null},kF:function(){this.element.attr("role","slider").attr("aria-orientation","vertical").attr("aria-describedby",this.element.prop("id")+":desc").attr("aria-valuemin",0).attr("aria-valuemax",Math.max(0,this.element.children().length-1))},JF:function(){this.element.removeAttr("role").removeAttr("aria-orientation").removeAttr("aria-describedby").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuetext")},
cLa:function(){var b,c;b=a.Q.qe()?"ariaTouchInstructionText":"ariaKeyboardInstructionText";c=g(document.createElement("div"));c.prop("id",this.element.prop("id")+":desc");c.addClass("oj-helper-hidden-accessible").text(this.T(b));this.ju().append(c)},ju:function(){null==this.xN&&(this.xN=this.$Ka());return this.xN},$Ka:function(){var b;this.wc?b=g(this.wc):(b=g(document.createElement("div")),this.element.parent()[0].replaceChild(b[0],this.element[0]));b.addClass("oj-indexer oj-component");b.prepend(this.element);
return b},mja:function(){var b,a,c,f,g,k,l;b=this.gma();if(null!=b){a=this.element;c=b.getIndexableSections();b.getMissingSections&&(f=b.getMissingSections());b=this.T("indexerOthers");g=this.widget().outerHeight();k=this.lR(c[0],f);a.append(k);k=k.outerHeight();g=Math.floor(g/k);this.ju().removeClass("oj-indexer-abbr");g=Math.floor((c.length+1)/g)+1;1<g&&this.ju().addClass("oj-indexer-abbr");for(k=1+g;k<c.length;k=k+g+1)1<g?(l=this.sLa(c,k-g,k-1),a.append(l)):k--,l=c[k],l=this.lR(l,f),a.append(l);
c=this.lR(c[c.length-1],f);a.append(c);c=this.lR(b);c.attr("data-others","true");a.append(c)}},lR:function(b,a){var c,f;c=b.label?b.label:b;f=g(document.createElement("li"));f.data("data-range",b).text(c);null!=a&&-1<a.indexOf(b)&&f.addClass("oj-disabled");return f},sLa:function(b,a,c){var f,h=[];f=g(document.createElement("li"));for(f.addClass("oj-indexer-ellipsis").data("data-range",b[a+Math.round((c-a)/2)]);a<=c;a++)h.push(b[a]);f.data("data-includes",h);return f},qb:function(){var b=this;this.element.uniqueId().addClass("oj-component-initnode").attr("tabIndex",
0);this._on(this.element,{click:function(a){b.J4(a)},keydown:function(a){b.Or(a)},focus:function(a){b.TS(a)},blur:function(a){b.hQa(a)}});this._focusable({applyHighlight:!0,setupHandlers:function(a,c){b.Uj=a;b.fj=c}})},J4:function(b){0===b.button&&(b=g(b.target),this.O7(b))},TS:function(){this.ju().addClass("oj-focus-ancestor");null==this.oy?this.Dn(this.element.children("li").first()):this.Dn(this.oy)},hQa:function(){this.ju().removeClass("oj-focus-ancestor")},Or:function(b){var a,c=!1;switch(b.keyCode){case 38:a=
this.oy.prev();break;case 40:a=this.oy.next();break;case 13:this.O7(this.oy),c=!0}null!=a&&0<a.length&&(c=!0,this.Dn(a));c&&b.preventDefault()},Dn:function(b){null!=this.oy&&this.fj(this.oy);this.Uj(b);this.L_a(b);this.oy=b},gma:function(){var b=this.option("data");if(null!=b&&(void 0==b.setSection||void 0==b.getIndexableSections))throw"Invalid IndexerModel";return b},O7:function(b){var c=b.data("data-range");b.attr("data-others")&&(c=a.Sq.SECTION_OTHERS);this.R7(c)},R7:function(b){var c=this,e;this.tm=
a.Context.getContext(this.element[0]).Dc().Xc({description:"setCurrentSection"});this.gma().setSection(b).then(function(b){null!=b&&(e=c.mh(b),null!=e&&c.Dn(e));c.tm(null);c.tm=null},function(){c.tm(null);c.tm=null})},L_a:function(b){var c,e;e="";c=b.data("data-includes");null!=c?0<c.length&&(e=c[0].label?c[0].label:c[0],c=c[c.length-1].label?c[c.length-1].label:c[c.length-1],e=this.T("ariaInBetweenText",{first:e,second:c})):(c=b.data("data-range"),e=c===a.Sq.SECTION_OTHERS?this.T("ariaOthersLabel"):
c);b.hasClass("oj-disabled")&&(e=e+". "+this.T("ariaDisabledLabel"));this.element.attr("aria-valuetext",e);this.element.attr("aria-valuenow",b.index())},mh:function(b){var a,c,f,h,k;a=this.element.children();for(c=0;c<a.length;c++)if(f=a.get(c),h=g(f).data("data-range"),k=g(f).data("data-includes"),null!=h&&h==b||null!=k&&-1<k.indexOf(b))return g(f);return null},Mo:function(b){b&&this.Ci&&a.Q.Hm(b,this.Ci)},Zr:function(b){b&&(null==this.Ci&&(this.Ci=this.Ph.bind(this)),a.Q.sm(b,this.Ci))},F_a:function(b){this.M$&&
(this.M$.off("panstart panmove panend"),g(b).Zg("destroy"));this.M$=null},JWa:function(b){var a=this,e,f,h,k,l,m,n,t,s,p,q,r;e={recognizers:[[c.Pan,{direction:c.DIRECTION_VERTICAL}]]};this.M$=g(b).Zg(e).on("panstart",function(b){f=b.gesture.target;h=a.element[0].getBoundingClientRect().left+5;k=f.getBoundingClientRect().top;a.O7(g(f));l=f;m=g(f).data("data-range");n=k}).on("panmove",function(b){t=n;n=k+b.gesture.deltaY;f=document.elementFromPoint(h,n);null!=f&&(s=n-t,l==f?(p=g(f).data("data-includes"),
null!=p&&(q=p.indexOf(m),r=null,0<s&&q<p.length-1?r=p[q+1]:0>s&&0<q&&(r=p[q-1]),null!=r&&(m=r,a.R7(r)))):g(f).data("data-range")&&(p=g(f).data("data-includes"),r=null,null!=p&&(0<s&&f==l.nextElementSibling?r=p[0]:0>s&&f==l.previousElementSibling&&(r=p[p.length-1])),null==r&&(r=g(f).data("data-range")),l=f,m=r,a.R7(m)))}).on("panend",function(){r=n=m=l=null})},Ph:function(b,a){0<b&&0<a&&this.refresh()}})})();a.J.Ua("oj-indexer","baseComponent",{properties:{data:{}},extension:{Kj:"ul",Ya:"ojIndexer"}});
a.J.register("oj-indexer",{metadata:a.J.getMetadata("oj-indexer")})});