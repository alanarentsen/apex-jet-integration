/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","knockout","ojs/ojeventtarget","ojs/ojdataprovider"],function(a,g,c){g=function(){function b(b,a){this.data=b;this.options=a;this.bj="key";this.Nc="keys";this.TZ="afterKeys";this.jD="direction";this.eD="attribute";this.eQ="sort";this.qf="sortCriteria";this.ec="data";this.Af="metadata";this.hw="indexes";this.Jh="offset";this.oi="size";this.lfa="idAttribute";this.UEa="implicitSort";this.NGa="sortComparators";this.aEa="comparators";this.jn="results";this.$m="fetchParameters";
this.aI="containsParameters";this.Nj="value";this.Zm="done";this.SZ="add";this.b0="remove";this.z0="update";this.nt=function(){return function(b,a,c){this.mc=b;this.metadata=a;this.data=c;this[b.Af]=a;this[b.ec]=c}}();this.Mk=function(){return function(b,a){this.mc=b;this.key=a;this[b.bj]=a}}();this.IC=function(){return function(b,a,c){this.mc=b;this.fetchParameters=a;this.results=c;this[b.$m]=a;this[b.jn]=c}}();this.rH=function(){return function(b,a,c){this.mc=b;this.containsParameters=a;this.results=
c;this[b.aI]=a;this[b.jn]=c}}();this.XY=function(){return function(b,a,c,d){this.mc=b;this.fetchParameters=a;this.results=c;this.done=d;this[b.$m]=a;this[b.jn]=c;this[b.Zm]=d}}();this.JC=function(){return function(b,a,c){this.mc=b;this.size=a;this.sortCriteria=c;this[b.oi]=a;this[b.qf]=c}}();this.Sv=function(){return function(b,a,c,d){this.mc=b;this.fetchParameters=a;this.data=c;this.metadata=d;this[b.$m]=a;this[b.ec]=c;this[b.Af]=d}}();this.Mv=function(){return function(b,a){this.mc=b;this.mn=a;
this[Symbol.asyncIterator]=function(){return this.mn}}}();this.Nv=function(){function b(a,c,d,e){this.mc=a;this.kL=c;this.nL=d;this.t1=e}b.prototype.next=function(){var b=this.kL(this.nL,this.t1);this.t1+=b.value[this.mc.ec].length;return Promise.resolve(b)};return b}();this.Ov=function(){return function(b,a,c){this.mc=b;this.value=a;this.done=c;this[b.Nj]=a;this[b.Zm]=c}}();this.EC=function(){return function(b,a,c,d){this.mc=b;this.add=a;this.remove=c;this.update=d;this[b.SZ]=a;this[b.b0]=c;this[b.z0]=
d}}();this.zO=function(){return function(b,a,c,d,e){this.mc=b;this.keys=a;this.metadata=c;this.data=d;this.indexes=e;this[b.Nc]=a;this[b.Af]=c;this[b.ec]=d;this[b.hw]=e}}();this.PY=function(){return function(b,a,c,d,e,g){this.mc=b;this.keys=a;this.metadata=d;this.data=e;this.indexes=g;this[b.Nc]=a;this[b.TZ]=c;this[b.Af]=d;this[b.ec]=e;this[b.hw]=g}}();this.Fsa=0;this.bV(b);null!=a&&null!=a[this.Nc]&&(this.Pg=a[this.Nc])}b.prototype.containsKeys=function(b){var a=this;return this.fetchByKeys(b).then(function(c){var h=
new Set;b[a.Nc].forEach(function(b){null!=c[a.jn].get(b)&&h.add(b)});return Promise.resolve(new a.rH(a,b,h))})};b.prototype.fetchByKeys=function(b){var a=this;this.UR();var c=new Map;b[this.Nc].forEach(function(b){var d=a.Pw().indexOf(b);0<=d&&c.set(b,new a.nt(a,new a.Mk(a,b),a.tA()[d]))});return Promise.resolve(new this.IC(this,b,c))};b.prototype.fetchByOffset=function(b){var a=this,c=null!=b?b[this.oi]:-1,h=null!=b?b[this.qf]:null,k=null!=b?0<b[this.Jh]?b[this.Jh]:0:0;this.UR();var c=new this.JC(this,
c,h),c=this.Mka(c,k),k=c[this.Nj],c=c[this.Zm],h=k[this.ec],g=k[this.Af].map(function(b){return b[a.bj]}),k=h.map(function(b,c){return new a.nt(a,new a.Mk(a,g[c]),b)});return Promise.resolve(new this.XY(this,b,k,c))};b.prototype.fetchFirst=function(b){return new this.Mv(this,new this.Nv(this,this.Mka.bind(this),b,0))};b.prototype.getCapability=function(a){return b.getCapability(a)};b.getCapability=function(b){return"sort"==b?{attributes:"multiple"}:"fetchByKeys"==b?{implementation:"lookup"}:"fetchByOffset"==
b?{implementation:"randomAccess"}:null};b.prototype.getTotalSize=function(){return Promise.resolve(this.tA().length)};b.prototype.Yd=function(){return 0<this.tA().length?"no":"yes"};b.prototype.tA=function(){return this[this.ec]instanceof Array?this[this.ec]:this[this.ec]()};b.prototype.Pw=function(){return null==this.Pg||this.Pg instanceof Array?this.Pg:this.Pg()};b.prototype.bV=function(b){if(!(b instanceof Array)){if(!this.JTa(b))throw Error("Invalid data type. ArrayDataProvider only supports Array or observableArray.");
var c=this;b.subscribe(function(b){var d,k,g=[],m=[],n=[];d=[];var t=[],s=!1,p=k=!1;for(d=0;d<b.length;d++)if("deleted"===b[d].status){s=!0;break}for(d=0;d<b.length;d++)if("added"===b[d].status){k=!0;break}k&&s&&(p=!0);if(s){for(d=0;d<b.length;d++)"deleted"===b[d].status&&(m.push(c.Pw()[b[d].index]),g.push(b[d].value),n.push(b[d].index));0<m.length&&m.map(function(b){b=c.Pw().indexOf(b);c.Pg.splice(b,1)});if(0<m.length&&!p){d=m.map(function(b){return new c.Mk(c,b)});var q=new Set;m.map(function(b){q.add(b)});
d=new c.zO(c,q,d,g,n);d=new c.EC(c,null,d,null);c.dispatchEvent(new a.tH(d))}}if(k){for(d=0;d<b.length;d++)"added"===b[d].status&&(c.UR(),k=c.iu(b[d].value),null==k&&(k=c.Pw()[b[d].index]),null==k&&(k=c.Fsa++,c.Pg.splice(b[d].index,0,k)),-1==c.Pw().indexOf(k)&&c.Pg.splice(b[d].index,0,k),m.push(k),k=c.Pw()[b[d].index+1],k=null==k?"":k,t.push(k),g.push(b[d].value),n.push(b[d].index));if(0<m.length&&!p){d=m.map(function(b){return new c.Mk(c,b)});var r=new Set;m.map(function(b){r.add(b)});var u=new Set;
t.map(function(b){u.add(b)});d=new c.PY(c,r,u,d,g,n);d=new c.EC(c,d,null,null);c.dispatchEvent(new a.tH(d))}p&&c.dispatchEvent(new a.FC)}},null,"arrayChange")}};b.prototype.JTa=function(b){return c.isObservable(b)&&void 0!==b.destroyAll};b.prototype.UR=function(){if(null==this.Pg){var b=null!=this.options?this.options[this.lfa]:null;this.Pg=[];for(var a=this.tA(),c=void 0,h=0,h=0;h<a.length;h++){c=this.iu(a[h]);if(null==c||"@index"==b)c=this.Fsa++;this.Pg[h]=c}}};b.prototype.iu=function(b){var a,
c=null!=this.options?this.options[this.lfa]:null;if(null!=c){if(Array.isArray(c)){var h;a=[];for(h=0;h<c.length;h++)a[h]=this.y4(b,c[h])}else a="@value"==c?this.GNa(b):this.y4(b,c);return a}return null};b.prototype.y4=function(b,a){return"function"==typeof b[a]?b[a]():b[a]};b.prototype.GNa=function(b){var a=this;return Object.keys(b).map(function(c){return a.y4(b,c)})};b.prototype.Mka=function(b,a){var c=this;this.UR();var h=null!=b?b[this.qf]:null,k=this.PNa(h),g=k.map(function(b){return c.tA()[b]}),
m=k.map(function(b){return c.Pw()[b]}),n=null!=b?0<b[this.oi]?b[this.oi]:0>b[this.oi]?c.Pw().length:25:25,k=g.slice(a,a+n),m=m.slice(a,a+n).map(function(b){return new c.Mk(c,b)}),g=a+n<g.length?!0:!1,h=this.GUa(h);null!=h&&(b=b||{},b[this.qf]=h);h=new this.Sv(this,b,k,m);return new this.Ov(this,h,!g)};b.prototype.PNa=function(b){var a=this.tA().map(function(b,a){return a});return this.NZa(a,b)};b.prototype.NZa=function(b,a){var c=this,h=b.map(function(b){return{index:b,value:c.tA()[b]}});null!=a&&
h.sort(this.HPa(a));return h.map(function(b){return b.index})};b.prototype.HPa=function(b){var a=this;return function(c,h){var k=null!=a.options?a.options[a.NGa]:null,g,m,n,t;for(g=0;g<b.length;g++)if(m=b[g][a.jD],n=b[g][a.eD],t=null,null!=k&&(t=k[a.aEa].get(n)),null!=t){if(m="descending"==m?-1:1,m*=t(c.value[n],h.value[n]),0!=m)return m}else if(t=0,t="string"===typeof c.value[n]?c.value[n]:new String(c.value[n]),n="string"===typeof h.value[n]?h.value[n]:new String(h.value[n]),t="ascending"==m?t.localeCompare(n,
void 0,{numeric:!0,sensitivity:"base"}):n.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"}),0!=t)return t;return 0}};b.prototype.GUa=function(b){var a=null!=this.options?this.options[this.UEa]:null;if(null!=a){if(null==b)return a;b=b.slice(0);for(var c=void 0,h=void 0,k=void 0,c=0;c<a.length;c++){k=!1;for(h=0;h<b.length;h++)b[h][this.eD]==a[c][this.eD]&&(k=!0);k||b.push(a[c])}}return b};return b}();a.ArrayDataProvider=g;a.UY.Lx(g);a.f.j("ArrayDataProvider.prototype.containsKeys",{containsKeys:g.prototype.containsKeys});
a.f.j("ArrayDataProvider.prototype.fetchByKeys",{fetchByKeys:g.prototype.fetchByKeys});a.f.j("ArrayDataProvider.prototype.fetchByOffset",{fetchByOffset:g.prototype.fetchByOffset});a.f.j("ArrayDataProvider.prototype.fetchFirst",{fetchFirst:g.prototype.fetchFirst});a.f.j("ArrayDataProvider.prototype.getCapability",{getCapability:g.prototype.getCapability});a.f.j("ArrayDataProvider.prototype.getTotalSize",{getTotalSize:g.prototype.getTotalSize});a.f.j("ArrayDataProvider.prototype.isEmpty",{Yd:g.prototype.Yd})});