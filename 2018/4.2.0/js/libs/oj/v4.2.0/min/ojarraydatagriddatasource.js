/**
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(a){a.Eb=function(g,c){if(!(g instanceof Array)&&"function"!=typeof g&&"function"!=typeof g.w$a)throw Error("_ERR_DATA_INVALID_TYPE_SUMMARY\n_ERR_DATA_INVALID_TYPE_DETAIL");this.tC=this.vPa(c);null!=c&&(this.columns=c.columns,this.sortCriteria=c.initialSort);a.Eb.N.constructor.call(this,g)};o_("ArrayDataGridDataSource",a.Eb,a);a.f.ua(a.Eb,a.Rv,"oj.ArrayDataGridDataSource");a.Eb.prototype.Init=function(){null==this.columns&&(this.columns=
this.ZNa(this.Oo()));this.gTa();"function"==typeof this.data&&this.data.subscribe(this.WZa.bind(this),null,"arrayChange");a.Eb.N.Init.call(this)};a.f.j("ArrayDataGridDataSource.prototype.Init",{Init:a.Eb.prototype.Init});a.Eb.prototype.No=null;a.f.j("ArrayDataGridDataSource.prototype.comparator",{No:a.Eb.prototype.No});a.Eb.prototype.sortCriteria=null;a.f.j("ArrayDataGridDataSource.prototype.sortCriteria",{sortCriteria:a.Eb.prototype.sortCriteria});a.Eb.prototype.vPa=function(a){if(null!=a&&null!=
a.rowHeader)if(a=a.rowHeader,"object"===typeof a){if(null!=a["default"]&&"none"==a["default"])return}else if(null!=a)return a;return"m_defaultIndex"};a.Eb.prototype.gTa=function(){var a;a=this.Oo();for(this.ZB=0;this.ZB<a.length;this.ZB+=1)a[this.ZB].ojKey=this.ZB.toString()};a.Eb.prototype.ZNa=function(a){var c,b;if("number"!==typeof a.length||0===a.length)return[];b=[];for(c in a[0])a[0].hasOwnProperty(c)&&(void 0!=this.tC&&c==this.tC||b.push(c));return b};a.Eb.prototype.getCount=function(a){return"row"===
a?this.Ax():"column"===a?this.columns.length:0};a.f.j("ArrayDataGridDataSource.prototype.getCount",{getCount:a.Eb.prototype.getCount});a.Eb.prototype.getCountPrecision=function(){return"exact"};a.f.j("ArrayDataGridDataSource.prototype.getCountPrecision",{getCountPrecision:a.Eb.prototype.getCountPrecision});a.Eb.prototype.F3=function(a,c){var b;if("row"===a){if(void 0==this.tC)return null;if("m_defaultIndex"==this.tC)return this.DS(c);b=this.Oo();return b[c][this.tC]}if("column"===a)return this.columns[c]};
a.Eb.prototype.BOa=function(a,c){var b;if("row"===a)return{key:this.DS(c)};if("column"===a)return b=this.F3(a,c),null!=this.sortCriteria&&this.sortCriteria.key===b?{key:this.F3(a,c),sortDirection:this.sortCriteria.direction}:{key:b}};a.Eb.prototype.fetchHeaders=function(g,c,b){var d,e,f,h;d=g.axis;e=g.start;f=g.count;e=Math.max(0,e);"column"===d?f=Math.min(this.columns.length,e+f):(h=this.Oo(),f=void 0===this.tC?e:Math.min(h.length,e+f));d=new a.Aj(e,f,d,this);null!=c&&null!=c.success&&(null==b&&
(b={}),c.success.call(b.success,d,g,null))};a.f.j("ArrayDataGridDataSource.prototype.fetchHeaders",{fetchHeaders:a.Eb.prototype.fetchHeaders});a.Eb.prototype.RNa=function(a,c){var b=this.columns[c];return this.Oo()[a][b]};a.Eb.prototype.rYa=function(a,c,b){this.Oo()[a][this.columns[c]]=b};a.Eb.prototype.SNa=function(a,c){return{keys:{row:this.DS(a),column:this.columns[c]}}};a.Eb.prototype.fetchCells=function(g,c,b){var d,e,f,h,k,l;for(d=0;d<g.length;d+=1)e=g[d],"row"===e.axis?(f=e.start,h=Math.min(this.Ax(),
f+e.count)):"column"===e.axis&&(k=e.start,l=Math.min(this.columns.length,k+e.count));void 0===h||void 0===l?null!=c&&null!=c.error&&(null==b&&(b={}),c.error.call(b.error)):(d=new a.zj(f,h,k,l,this),null!=c&&null!=c.success&&(null==b&&(b={}),c.success.call(b.success,d,g)))};a.f.j("ArrayDataGridDataSource.prototype.fetchCells",{fetchCells:a.Eb.prototype.fetchCells});a.Eb.prototype.keys=function(a){var c=a.row,b=a.column;return new Promise(function(a){a({row:this.DS(c),column:this.columns[b]})}.bind(this))};
a.f.j("ArrayDataGridDataSource.prototype.keys",{keys:a.Eb.prototype.keys});a.Eb.prototype.indexes=function(a){var c=a.row,b=a.column;return new Promise(function(a){a({row:this.CS(c),column:this.columns.indexOf(b)})}.bind(this))};a.f.j("ArrayDataGridDataSource.prototype.indexes",{indexes:a.Eb.prototype.indexes});a.Eb.prototype.sort=function(a,c,b){var d=[],e=[],f;null!=c&&null==b&&(b={});void 0==this.oC&&(this.vVa=this.sortCriteria,this.oC=this.data.slice());null==a?a=this.sortCriteria:this.sortCriteria=
a;if(null==a)this.v7(c,b);else if(f=a.axis,a=a.key,"column"===f)this.Oo().sort(this.UJ()),null!=c&&null!=c.success&&c.success.call(b.success);else if("row"===f){a=this.CS(a);for(f=0;f<this.columns.length;f+=1)d[f]=this.Oo()[a][this.columns[f]];d.sort(this.UJ());for(f=0;f<this.columns.length;f+=1)e[f]=this.columns[d.indexOf(this.Oo()[a][this.columns[f]])];this.Yza=this.columns;this.columns=e;null!=c&&null!=c.success&&c.success.call(b.success)}else null!==c&&null!=c.error&&c.error.call(b.error,"Invalid axis value")};
a.f.j("ArrayDataGridDataSource.prototype.sort",{sort:a.Eb.prototype.sort});a.Eb.prototype.v7=function(a,c){null!=this.oC&&(this.data=this.oC,this.sortCriteria=this.vVa);null!=this.Yza&&(this.columns=this.Yza);null!=a&&null!=a.success&&a.success.call(c.success)};a.Eb.prototype.getCapability=function(a){return"sort"===a?"column":"move"===a?"row":null};a.f.j("ArrayDataGridDataSource.prototype.getCapability",{getCapability:a.Eb.prototype.getCapability});a.Eb.prototype.UJ=function(){var a,c,b;a=this.comparator;
return null==a?(a=this.sortCriteria.key,c=this.sortCriteria.direction,b=this.sortCriteria.axis,this.XUa(c,a,b)):a};a.Eb.prototype.XUa=function(a,c,b){if("ascending"===a)return function(a,e){var f,g;void 0!=c&&"column"==b&&(a instanceof Array?(a=a[parseInt(c,10)],e=e[parseInt(c,10)]):(a=a[c],e=e[c]));f=isNaN(a);g=isNaN(e);a instanceof Date&&(a=a.toISOString(),f=!0);e instanceof Date&&(e=e.toISOString(),g=!0);return f&&g?a<e?-1:a===e?0:1:f?1:g?-1:a-e};if("descending"===a)return function(a,e){var f,
g;void 0!=c&&"column"==b&&(a instanceof Array?(a=a[parseInt(c,10)],e=e[parseInt(c,10)]):(a=a[c],e=e[c]));f=isNaN(a);g=isNaN(e);a instanceof Date&&(a=a.toISOString(),f=!0);e instanceof Date&&(e=e.toISOString(),g=!0);return f&&g?a>e?-1:a===e?0:1:f?-1:g?1:e-a}};a.Eb.prototype.move=function(a,c){var b,d;b=this.CS(a);d=this.data.splice(b,1)[0];this.data instanceof Array&&(b=this.Ir("delete",a,null,b,-1,!0),this.handleEvent("change",b));null===c?(this.data.push(d),b=this.data.length-1):(b=this.CS(c),this.data.splice(b,
0,d));this.data instanceof Array&&(b=this.Ir("insert",a,null,b,-1),this.handleEvent("change",b));null!=this.oC&&(this.oC=this.data.slice())};a.f.j("ArrayDataGridDataSource.prototype.move",{move:a.Eb.prototype.move});a.Eb.prototype.moveOK=function(){return"valid"};a.f.j("ArrayDataGridDataSource.prototype.moveOK",{moveOK:a.Eb.prototype.moveOK});a.Eb.prototype.Oo=function(){return"function"===typeof this.data?this.data():this.data};a.Eb.prototype.CS=function(a){var c,b=this.Oo();for(c=0;c<b.length;c++)if(b[c].ojKey===
a)return c;return-1};a.Eb.prototype.DS=function(a){var c=this.Oo();return c[a]?c[a].ojKey:null};a.Eb.prototype.Ir=function(a,c,b,d,e,f){var h={source:this};h.operation=a;h.keys={row:c,column:b};h.indexes={row:d,column:e};h.silent=f;return h};a.Eb.prototype.WZa=function(a){var c,b,d,e=!1;b=!1;var f=[],h=[];for(c=0;c<a.length;c++){d=a[c];if(void 0!==d.moved){b=!0;d=this.Ir("refresh",null,null);this.handleEvent("change",d);break}"added"===d.status&&(e=!0)}if(!b){for(c=0;c<a.length;c++)d=a[c],"deleted"===
d.status&&(b=d.value,d=d.index,b=b.ojKey,f.push({row:b,column:-1}),h.push({row:d,column:-1}));0<f.length&&(d={source:this,operation:"delete",keys:f,indexes:h,silent:e},this.handleEvent("change",d));for(c=0;c<a.length;c++)d=a[c],"added"===d.status&&(b=d.value,d=d.index,null==b.ojKey&&(b.ojKey=this.ZB.toString(),this.ZB++),b=b.ojKey,d=this.Ir("insert",b,null,d,-1),this.handleEvent("change",d))}null!=this.oC&&(this.oC=this.data.slice())};a.Eb.prototype.Ax=function(){return this.Oo().length};a.Eb.prototype.wxa=
function(){return this.tC};a.f.j("ArrayDataGridDataSource.prototype.getRowHeaderKey",{wxa:a.Eb.prototype.wxa});a.Eb.prototype.Vx=function(){return this.columns};a.f.j("ArrayDataGridDataSource.prototype.getColumns",{Vx:a.Eb.prototype.Vx});a.Eb.prototype.getData=function(){return this.data};a.f.j("ArrayDataGridDataSource.prototype.getData",{getData:a.Eb.prototype.getData});a.Aj=function(a,c,b,d){this.$d=a;this.Zh=c;this.Sya=b;this.Uo=d};o_("ArrayHeaderSet",a.Aj,a);a.Aj.prototype.getData=function(g,
c){if(null==this.Uo)return null;a.C.assert(g<=this.Zh&&g>=this.$d,"index out of bounds");a.C.assert(null==c||0==c,"level out of bounds");return this.Uo.F3(this.Sya,g)};a.f.j("ArrayHeaderSet.prototype.getData",{getData:a.Aj.prototype.getData});a.Aj.prototype.getMetadata=function(g,c){if(null==this.Uo)return null;a.C.assert(g<=this.Zh&&g>=this.$d,"index out of bounds");a.C.assert(null==c||0==c,"level out of bounds");return this.Uo.BOa(this.Sya,g)};a.f.j("ArrayHeaderSet.prototype.getMetadata",{getMetadata:a.Aj.prototype.getMetadata});
a.Aj.prototype.getLevelCount=function(){return 0<this.getCount()?1:0};a.f.j("ArrayHeaderSet.prototype.getLevelCount",{getLevelCount:a.Aj.prototype.getLevelCount});a.Aj.prototype.getExtent=function(g,c){a.C.assert(g<=this.Zh&&g>=this.$d,"index out of bounds");a.C.assert(null==c||0==c,"level out of bounds");return{extent:1,more:{before:!1,after:!1}}};a.f.j("ArrayHeaderSet.prototype.getExtent",{getExtent:a.Aj.prototype.getExtent});a.Aj.prototype.getDepth=function(g,c){a.C.assert(g<=this.Zh&&g>=this.$d,
"index out of bounds");a.C.assert(null==c||0==c,"level out of bounds");return 1};a.f.j("ArrayHeaderSet.prototype.getDepth",{getDepth:a.Aj.prototype.getDepth});a.Aj.prototype.getCount=function(){return null==this.Uo?0:Math.max(0,this.Zh-this.$d)};a.f.j("ArrayHeaderSet.prototype.getCount",{getCount:a.Aj.prototype.getCount});a.Aj.prototype.getStart=function(){return this.$d};a.f.j("ArrayHeaderSet.prototype.getStart",{getStart:a.Aj.prototype.getStart});a.zj=function(a,c,b,d,e){this.Za=a;this.Ra=c;this.Rs=
b;this.aC=d;this.Uo=e};o_("ArrayCellSet",a.zj,a);a.zj.prototype.getData=function(a){var c,b,d;c=this;b=a.row;d=a.column;a={};Object.defineProperty(a,"data",{enumerable:!0,get:function(){return c.Uo.RNa(b,d)},set:function(a){c.Uo.rYa(b,d,a)}});return a};a.f.j("ArrayCellSet.prototype.getData",{getData:a.zj.prototype.getData});a.zj.prototype.getMetadata=function(a){return this.Uo.SNa(a.row,a.column)};a.f.j("ArrayCellSet.prototype.getMetadata",{getMetadata:a.zj.prototype.getMetadata});a.zj.prototype.getStart=
function(a){return"row"==a?this.Za:"column"==a?this.Rs:-1};a.f.j("ArrayCellSet.prototype.getStart",{getStart:a.zj.prototype.getStart});a.zj.prototype.getCount=function(a){return"row"===a?Math.max(0,this.Ra-this.Za):"column"===a?Math.max(0,this.aC-this.Rs):0};a.f.j("ArrayCellSet.prototype.getCount",{getCount:a.zj.prototype.getCount});a.zj.prototype.getExtent=function(){return{row:{extent:1,more:{before:!1,after:!1}},column:{extent:1,more:{before:!1,after:!1}}}};a.f.j("ArrayCellSet.prototype.getExtent",
{getExtent:a.zj.prototype.getExtent});a.zj.prototype.oG=function(){return this.Za};a.f.j("ArrayCellSet.prototype.getStartRow",{oG:a.zj.prototype.oG});a.zj.prototype.nG=function(){return this.Rs};a.f.j("ArrayCellSet.prototype.getStartColumn",{nG:a.zj.prototype.nG})});